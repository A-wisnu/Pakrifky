{
  "name": "Masjid AI Advanced Workflow - Rich Features",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "webhook-masjid-ai",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "1",
      "name": "📱 WhatsApp Gateway",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [200, 400]
    },
    {
      "parameters": {
        "functionCode": "// 🚀 ADVANCED MESSAGE PROCESSOR & INTELLIGENT CLASSIFIER\nconst moment = require('moment');\n\n// Configuration with Rich Features\nconst CONFIG = {\n  apis: {\n    openrouter: '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',\n    supabase_url: 'https://bvaxxlmhrzocbrqiykoqul.supabase.co',\n    supabase_key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ2YXh4bG1ocnpvY2JycWl5a29xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjMxMDMsImV4cCI6MjA2OTQzOTEwM30.GjDhx8BUR7Y4FUS2PZalEeDhKVt_zQWGTEV_5nKKgrg',\n    prayer_api: 'https://api.aladhan.com/v1/timingsByCity?city=Jakarta&country=Indonesia',\n    weather_api: 'https://api.openweathermap.org/data/2.5/weather?q=Jakarta&appid=demo&units=metric',\n    qiblat_api: 'https://api.aladhan.com/v1/qibla/Jakarta/Indonesia',\n    hadits_api: 'https://hadits-api-id.vercel.app/hadith',\n    quran_api: 'https://api.quran.com/api/v4/verses/random'\n  },\n  ai_models: {\n    primary: 'moonshotai/kimi-k2:free',\n    fallback: 'google/gemma-7b-it:free'\n  }\n};\n\n// Masjid Complete Information\nconst MASJID = {\n  info: {\n    nama: 'Masjid Al-Ikhlas',\n    alamat: 'Jl. Raya Masjid No. 123, Jakarta Selatan 12345',\n    coordinates: { lat: -6.2088, lng: 106.8456 },\n    whatsapp: '+62-812-3456-7890',\n    email: 'info@masjidalukhlas.id',\n    website: 'https://masjidalukhlas.id',\n    established: '15 Maret 1985',\n    capacity: 2000\n  },\n  \n  rekening: {\n    banks: {\n      bca: { no: '1234567890', name: 'Masjid Al-Ikhlas' },\n      mandiri: { no: '0987654321', name: 'Yayasan Masjid Al-Ikhlas' },\n      bri: { no: '5555666677778888', name: 'Takmir Masjid Al-Ikhlas' }\n    },\n    ewallet: {\n      dana: '081234567890',\n      gopay: '081234567890',\n      ovo: '081234567890',\n      shopeepay: '081234567890'\n    },\n    qris: 'https://example.com/qris-masjid.png'\n  },\n  \n  ustadz: [\n    {\n      nama: 'Ustadz Dr. Ahmad Dahlan, Lc., M.A',\n      spesialisasi: ['Fiqh Ibadah', 'Akhlaq & Tasawuf', 'Tafsir Al-Quran', 'Resolusi Konflik'],\n      jadwal: 'Senin-Kamis 19:00-21:00, Jumat 08:00-11:00, Sabtu 14:00-17:00',\n      kontak: '+62-813-1111-2222',\n      email: 'ahmad@masjidalukhlas.id',\n      pendidikan: 'Lulusan Al-Azhar University, Kairo',\n      pengalaman: '15+ tahun'\n    },\n    {\n      nama: 'Ustadz Muhammad Ridwan, S.H.I., M.E.I',\n      spesialisasi: ['Ekonomi Syariah', 'Hukum Keluarga', 'Parenting Islami', 'Entrepreneurship Halal'],\n      jadwal: 'Selasa-Jumat 08:00-12:00, Sabtu 19:00-21:00, Minggu 09:00-11:00',\n      kontak: '+62-813-3333-4444',\n      email: 'ridwan@masjidalukhlas.id',\n      pendidikan: 'Lulusan UIN Jakarta & Malaysia',\n      pengalaman: '12+ tahun'\n    },\n    {\n      nama: 'Ustadzah Dr. Aisyah Mahmud, Lc., M.Pd',\n      spesialisasi: ['Konsultasi Wanita', 'Pendidikan Anak', 'Kesehatan Reproduksi Syariah', 'Psikologi Islam'],\n      jadwal: 'Rabu-Jumat 14:00-17:00, Sabtu 09:00-12:00 (Khusus wanita)',\n      kontak: '+62-814-4444-5555',\n      email: 'aisyah@masjidalukhlas.id',\n      pendidikan: 'Lulusan Universitas Madinah',\n      pengalaman: '10+ tahun'\n    }\n  ],\n  \n  fasilitas: {\n    utama: ['Masjid 2000 jamaah', 'AC Central', 'Sound System Digital', 'Karpet Premium', 'Mihrab Marmer'],\n    wudhu: ['40 kran pria', '35 kran wanita', 'Air hangat', 'Sabun & tissue'],\n    toilet: ['15 toilet pria', '12 toilet wanita', 'Fasilitas difabel', 'Baby changing room'],\n    parkir: ['500 motor', '200 mobil', 'Security 24/7', 'CCTV monitoring'],\n    pendidikan: ['8 ruang kelas ber-AC', 'Proyektor', 'Perpustakaan 5000+ buku', 'Lab komputer'],\n    kesehatan: ['Klinik umum', 'Apotek mini', 'Ruang konseling', 'Ambulans'],\n    lainnya: ['Dapur modern', 'Aula 500 orang', 'Toko koperasi', 'ATM center']\n  }\n};\n\n// Rich Prayer Times with Dynamic Features\nfunction getPrayerTimes() {\n  const now = moment();\n  const times = {\n    fajr: '04:30',\n    sunrise: '05:45', \n    dhuhr: '12:15',\n    asr: '15:30',\n    maghrib: '18:45',\n    isha: '20:00'\n  };\n  \n  // Calculate next prayer\n  const currentHour = now.hour();\n  const currentMinute = now.minute();\n  const currentTime = currentHour * 60 + currentMinute;\n  \n  const prayerMinutes = {\n    fajr: 4 * 60 + 30,\n    dhuhr: 12 * 60 + 15,\n    asr: 15 * 60 + 30,\n    maghrib: 18 * 60 + 45,\n    isha: 20 * 60 + 0\n  };\n  \n  let nextPrayer = 'Subuh';\n  let nextTime = '04:30';\n  let countdown = '';\n  \n  for (const [prayer, minutes] of Object.entries(prayerMinutes)) {\n    if (currentTime < minutes) {\n      nextPrayer = prayer === 'fajr' ? 'Subuh' : \n                   prayer === 'dhuhr' ? 'Dzuhur' :\n                   prayer === 'asr' ? 'Ashar' :\n                   prayer === 'maghrib' ? 'Magrib' : 'Isya';\n      nextTime = times[prayer];\n      const remaining = minutes - currentTime;\n      const hours = Math.floor(remaining / 60);\n      const mins = remaining % 60;\n      countdown = `${hours}h ${mins}m`;\n      break;\n    }\n  }\n  \n  return { times, nextPrayer, nextTime, countdown };\n}\n\n// Advanced Intent Classification with Context\nfunction classifyIntent(message, context = {}) {\n  const msg = message.toLowerCase();\n  const time = moment();\n  const hour = time.hour();\n  const day = time.day(); // 0=Sunday, 5=Friday\n  \n  // Advanced intent patterns with smart scoring\n  const intents = {\n    // Core Religious Services\n    jadwal_shalat: {\n      keywords: ['jadwal shalat', 'waktu shalat', 'adzan', 'subuh', 'dzuhur', 'ashar', 'magrib', 'isya', 'prayer time'],\n      score: hour >= 4 && hour <= 20 ? 10 : 7\n    },\n    \n    kiblat_direction: {\n      keywords: ['kiblat', 'qibla', 'arah shalat', 'direction', 'compass'],\n      score: 8\n    },\n    \n    doa_harian: {\n      keywords: ['doa', 'dzikir', 'wirid', 'tasbih', 'istighfar', 'daily prayer'],\n      score: 9\n    },\n    \n    ayat_quran: {\n      keywords: ['ayat', 'quran', 'alquran', 'surah', 'verse', 'bacaan'],\n      score: 9\n    },\n    \n    hadits_nabi: {\n      keywords: ['hadits', 'hadith', 'sunnah', 'nabi', 'rasul', 'prophet'],\n      score: 8\n    },\n    \n    // Educational & Learning\n    kajian_pengajian: {\n      keywords: ['kajian', 'pengajian', 'ceramah', 'kuliah', 'ustadz', 'belajar islam', 'study'],\n      score: day === 5 ? 10 : 7 // Higher on Friday\n    },\n    \n    tpq_tahfidz: {\n      keywords: ['tpq', 'tahfidz', 'mengaji', 'belajar quran', 'hafalan', 'ngaji anak'],\n      score: 8\n    },\n    \n    kelas_bahasa_arab: {\n      keywords: ['bahasa arab', 'arabic', 'belajar arab', 'kursus arab', 'nahwu', 'sharaf'],\n      score: 7\n    },\n    \n    // Consultation Services\n    konsultasi_syariah: {\n      keywords: ['konsultasi', 'tanya ustadz', 'fatwa', 'hukum islam', 'syariah', 'fiqh'],\n      score: 9\n    },\n    \n    konsultasi_keluarga: {\n      keywords: ['keluarga', 'pernikahan', 'suami istri', 'anak', 'parenting', 'rumah tangga'],\n      score: 8\n    },\n    \n    konsultasi_ekonomi: {\n      keywords: ['ekonomi', 'bisnis', 'investasi', 'saham', 'trading', 'keuangan', 'halal haram'],\n      score: 8\n    },\n    \n    // Community Services\n    donasi_infaq: {\n      keywords: ['donasi', 'infaq', 'sedekah', 'zakat', 'transfer', 'rekening', 'qris', 'bayar'],\n      score: 8\n    },\n    \n    program_sosial: {\n      keywords: ['sosial', 'bantuan', 'dhuafa', 'yatim', 'fakir miskin', 'beasiswa', 'santunan'],\n      score: 7\n    },\n    \n    layanan_jenazah: {\n      keywords: ['jenazah', 'meninggal', 'kafan', 'pemakaman', 'tahlil', 'doa mayit', 'funeral'],\n      score: 10\n    },\n    \n    ambulans_emergency: {\n      keywords: ['ambulans', 'emergency', 'darurat', 'sakit', 'rumah sakit', 'urgent'],\n      score: 10\n    },\n    \n    // Administrative\n    daftar_nikah: {\n      keywords: ['nikah', 'menikah', 'akad', 'pernikahan', 'wedding', 'marriage'],\n      score: 8\n    },\n    \n    sewa_gedung: {\n      keywords: ['sewa', 'gedung', 'aula', 'acara', 'event', 'rent'],\n      score: 6\n    },\n    \n    info_masjid: {\n      keywords: ['info', 'alamat', 'lokasi', 'kontak', 'jam buka', 'fasilitas', 'about'],\n      score: 6\n    },\n    \n    // Health & Wellness\n    klinik_kesehatan: {\n      keywords: ['klinik', 'dokter', 'kesehatan', 'berobat', 'medical', 'health'],\n      score: 7\n    },\n    \n    ruqyah_thibbun: {\n      keywords: ['ruqyah', 'thibbun nabawi', 'pengobatan islam', 'herbal', 'bekam', 'hijama'],\n      score: 7\n    },\n    \n    // Modern Features\n    cuaca_jakarta: {\n      keywords: ['cuaca', 'weather', 'hujan', 'panas', 'temperature', 'iklim'],\n      score: 5\n    },\n    \n    live_streaming: {\n      keywords: ['live', 'streaming', 'online', 'youtube', 'broadcast', 'virtual'],\n      score: hour >= 11 && hour <= 13 ? 8 : 6 // Higher during Jumatan\n    },\n    \n    reminder_notification: {\n      keywords: ['reminder', 'notifikasi', 'alarm', 'ingat', 'notification'],\n      score: 7\n    },\n    \n    // AI Interactive\n    ai_chat_islamic: {\n      keywords: ['tanya', 'bagaimana', 'kenapa', 'apa itu', 'jelaskan', 'chat', 'diskusi'],\n      score: 6\n    },\n    \n    translate_arabic: {\n      keywords: ['translate', 'terjemah', 'arabic', 'artinya', 'meaning'],\n      score: 7\n    },\n    \n    // Social\n    salam_greeting: {\n      keywords: ['assalamualaikum', 'salam', 'halo', 'hai', 'selamat'],\n      score: hour < 6 || hour > 21 ? 4 : 6\n    }\n  };\n  \n  // Find best match\n  let bestMatch = { intent: 'ai_chat_islamic', score: 0 };\n  \n  for (const [intent, config] of Object.entries(intents)) {\n    const matches = config.keywords.filter(keyword => msg.includes(keyword)).length;\n    const totalScore = matches * config.score;\n    \n    if (totalScore > bestMatch.score) {\n      bestMatch = { intent, score: totalScore, confidence: Math.min(totalScore / 10, 1) };\n    }\n  }\n  \n  return bestMatch;\n}\n\n// Smart Message Parser\nfunction parseMessage(body) {\n  let phone, message, messageType, mediaUrl, timestamp;\n  \n  // Multiple WhatsApp provider support\n  if (body.entry && body.entry[0]?.changes?.[0]?.value?.messages) {\n    // WhatsApp Business API\n    const msg = body.entry[0].changes[0].value.messages[0];\n    phone = msg.from;\n    messageType = msg.type;\n    message = msg.text?.body || `[${messageType}]`;\n    mediaUrl = msg.image?.id || msg.audio?.id || msg.video?.id;\n    timestamp = msg.timestamp;\n  } else if (body.device && body.message) {\n    // Fonnte\n    phone = body.device;\n    message = body.message;\n    messageType = body.message_type || 'text';\n    mediaUrl = body.file;\n    timestamp = body.date;\n  } else if (body.from && body.body) {\n    // Woowa\n    phone = body.from;\n    message = body.body;\n    messageType = body.type || 'text';\n    mediaUrl = body.media_url;\n    timestamp = body.timestamp;\n  } else if (body.phone && body.message) {\n    // Generic\n    phone = body.phone;\n    message = body.message;\n    messageType = body.type || 'text';\n    mediaUrl = body.media_url;\n    timestamp = body.timestamp || Date.now();\n  }\n  \n  return { phone, message, messageType, mediaUrl, timestamp };\n}\n\n// Clean phone number\nfunction cleanPhone(phone) {\n  if (!phone) return null;\n  phone = phone.replace(/[^0-9+]/g, '');\n  if (phone.startsWith('0')) phone = '+62' + phone.substring(1);\n  else if (phone.startsWith('62')) phone = '+' + phone;\n  else if (!phone.startsWith('+')) phone = '+62' + phone;\n  return phone;\n}\n\n// Main Processing\nconst startTime = Date.now();\nconst body = $input.all()[0].body;\n\nconst parsed = parseMessage(body);\nlet { phone, message, messageType, mediaUrl, timestamp } = parsed;\n\nphone = cleanPhone(phone);\n\nif (!phone || !message) {\n  return [{\n    json: {\n      error: 'Invalid input',\n      hasError: true,\n      phone: phone || 'unknown',\n      message: message || 'empty'\n    }\n  }];\n}\n\n// Classify intent\nconst classification = classifyIntent(message);\nconst prayerData = getPrayerTimes();\n\n// Prepare rich output\nreturn [{\n  json: {\n    // Core data\n    phone: phone,\n    message: message,\n    messageType: messageType,\n    mediaUrl: mediaUrl,\n    timestamp: timestamp || new Date().toISOString(),\n    \n    // Classification\n    intent: classification.intent,\n    confidence: classification.confidence,\n    score: classification.score,\n    \n    // Context\n    prayer_data: prayerData,\n    current_time: moment().format('HH:mm'),\n    current_date: moment().format('DD/MM/YYYY'),\n    day_name: moment().format('dddd'),\n    is_friday: moment().day() === 5,\n    is_prayer_time: [4, 12, 15, 18, 20].includes(moment().hour()),\n    \n    // Processing\n    processing_time: Date.now() - startTime,\n    hasError: false,\n    \n    // Config\n    config: CONFIG,\n    masjid: MASJID\n  }\n}];"
      },
      "id": "2",
      "name": "🧠 Smart Classifier",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 400]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.intent }}",
              "operation": "equal",
              "value2": "ai_chat_islamic"
            }
          ]
        }
      },
      "id": "3",
      "name": "🤖 Need AI?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [700, 400]
    },
    {
      "parameters": {
        "functionCode": "// 🤖 ADVANCED AI CHAT PROCESSOR\nconst data = $input.all()[0].json;\n\n// Enhanced Islamic AI Assistant\nasync function generateAIResponse(message, context) {\n  const systemPrompt = `Anda adalah AI Assistant Masjid ${context.masjid.info.nama}, asisten cerdas untuk umat Islam. \n\nKARAKTER:\n- Berpengetahuan luas tentang Islam (Al-Quran, Hadits, Fiqh, Sejarah)\n- Bijaksana, sabar, dan penuh empati dalam menjawab\n- Menggunakan bahasa Indonesia yang mudah dipahami\n- Selalu sopan dan santun dalam berinteraksi\n- Memberikan jawaban yang praktis dan aplikatif\n\nKONTEKS WAKTU:\n- Hari: ${context.day_name}\n- Tanggal: ${context.current_date}\n- Waktu: ${context.current_time} WIB\n- Shalat selanjutnya: ${context.prayer_data.nextPrayer} (${context.prayer_data.nextTime})\n\nINFORMASI MASJID:\n- Nama: ${context.masjid.info.nama}\n- Alamat: ${context.masjid.info.alamat}\n- WhatsApp: ${context.masjid.info.whatsapp}\n- Berdiri: ${context.masjid.info.established}\n- Kapasitas: ${context.masjid.info.capacity} jamaah\n\nUSTADZ TERSEDIA:\n${context.masjid.ustadz.map(u => `- ${u.nama} (${u.spesialisasi.join(', ')}) - ${u.jadwal}`).join('\\n')}\n\nPEDOMAN:\n✅ Gunakan emoji yang relevan dan menarik\n✅ Berikan jawaban yang terstruktur dan mudah dibaca\n✅ Sertakan dalil Al-Quran atau Hadits jika relevan\n✅ Rujuk ke ustadz untuk pertanyaan fiqh yang kompleks\n✅ Berikan saran praktis yang bisa diterapkan\n✅ Akhiri dengan doa atau motivasi Islami\n❌ Jangan memberikan fatwa tanpa dasar yang kuat\n❌ Hindari pembahasan politik atau SARA\n❌ Jangan berlebihan dalam klaim atau janji`;\n\n  try {\n    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${context.config.apis.openrouter}`,\n        'Content-Type': 'application/json',\n        'HTTP-Referer': 'https://masjidalukhlas.id',\n        'X-Title': 'Masjid AI Assistant'\n      },\n      body: JSON.stringify({\n        model: context.config.ai_models.primary,\n        messages: [\n          { role: 'system', content: systemPrompt },\n          { role: 'user', content: message }\n        ],\n        max_tokens: 1500,\n        temperature: 0.7,\n        top_p: 0.9\n      })\n    });\n    \n    if (response.ok) {\n      const result = await response.json();\n      let aiResponse = result.choices[0].message.content;\n      \n      // Add Islamic greeting if not present\n      if (!aiResponse.includes('🤲') && !aiResponse.includes('السلام')) {\n        aiResponse = '🤲 ' + aiResponse;\n      }\n      \n      // Add helpful suggestions\n      aiResponse += `\\n\\n💡 **Saran Lainnya:**\\n• Ketik \"jadwal shalat\" untuk waktu shalat\\n• Ketik \"tanya ustadz\" untuk konsultasi\\n• Ketik \"doa\" untuk dzikir harian\\n• Ketik \"info masjid\" untuk informasi lengkap`;\n      \n      return {\n        response: aiResponse,\n        model_used: context.config.ai_models.primary,\n        tokens: result.usage?.total_tokens || 0,\n        status: 'success'\n      };\n    } else {\n      throw new Error('AI API Error');\n    }\n  } catch (error) {\n    // Fallback response\n    return {\n      response: `🤖 Maaf, saya sedang mengalami gangguan teknis. \\n\\nUntuk bantuan segera:\\n👨‍🏫 Ustadz Ahmad: ${context.masjid.ustadz[0].kontak}\\n👨‍🏫 Ustadz Ridwan: ${context.masjid.ustadz[1].kontak}\\n📱 Admin: ${context.masjid.info.whatsapp}\\n\\n🔄 Silakan coba lagi dalam beberapa menit.`,\n      model_used: 'fallback',\n      tokens: 0,\n      status: 'error'\n    };\n  }\n}\n\nconst result = await generateAIResponse(data.message, data);\n\nreturn [{\n  json: {\n    ...data,\n    response: result.response,\n    ai_model: result.model_used,\n    ai_tokens: result.tokens,\n    ai_status: result.status,\n    response_type: 'AI_GENERATED'\n  }\n}];"
      },
      "id": "4",
      "name": "🤖 AI Chat Engine",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [950, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.intent }}",
              "operation": "equal",
              "value2": "jadwal_shalat"
            }
          ]
        }
      },
      "id": "5",
      "name": "🕌 Prayer Service?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [950, 500]
    },
    {
      "parameters": {
        "functionCode": "// 🕌 ADVANCED PRAYER TIME SERVICE\nconst data = $input.all()[0].json;\nconst moment = require('moment');\n\nfunction generatePrayerResponse(data) {\n  const prayerData = data.prayer_data;\n  const masjid = data.masjid;\n  const now = moment();\n  \n  let response = `🕌 *JADWAL SHALAT HARI INI*\\n📅 ${now.format('dddd, DD MMMM YYYY')}\\n📍 ${masjid.info.nama}\\n\\n`;\n  \n  // Prayer times with status\n  const times = prayerData.times;\n  const currentHour = now.hour();\n  \n  response += `🌅 **Subuh:** ${times.fajr} WIB ${currentHour < 4 ? '⏰' : currentHour < 6 ? '✅' : '✅'}\\n`;\n  response += `🌄 **Terbit:** ${times.sunrise} WIB\\n`;\n  response += `☀️ **Dzuhur:** ${times.dhuhr} WIB ${currentHour < 12 ? '⏰' : currentHour < 13 ? '✅' : '✅'}\\n`;\n  response += `🌤️ **Ashar:** ${times.asr} WIB ${currentHour < 15 ? '⏰' : currentHour < 16 ? '✅' : '✅'}\\n`;\n  response += `🌅 **Magrib:** ${times.maghrib} WIB ${currentHour < 18 ? '⏰' : currentHour < 19 ? '✅' : '✅'}\\n`;\n  response += `🌙 **Isya:** ${times.isha} WIB ${currentHour < 20 ? '⏰' : '✅'}\\n\\n`;\n  \n  // Next prayer info\n  response += `⏰ **Shalat Selanjutnya:** ${prayerData.nextPrayer}\\n`;\n  response += `🕐 **Waktu:** ${prayerData.nextTime} WIB\\n`;\n  if (prayerData.countdown) {\n    response += `⏳ **Countdown:** ${prayerData.countdown}\\n\\n`;\n  }\n  \n  // Additional info\n  response += `🕋 **Info Kiblat:** 294° dari Utara\\n`;\n  response += `📱 **Reminder:** Ketik \"reminder on\" untuk notifikasi\\n`;\n  response += `📍 **Lokasi Masjid:** ${masjid.info.alamat}\\n\\n`;\n  \n  // Quranic verse\n  response += `🤲 *\"Aqiimu ash-shalata li dhikrii\"*\\n*\"Dirikanlah shalat untuk mengingat-Ku\"* (QS. Thaha: 14)\\n\\n`;\n  \n  // Quick actions\n  response += `💡 **Menu Cepat:**\\n`;\n  response += `• Ketik \"kiblat\" untuk arah kiblat\\n`;\n  response += `• Ketik \"doa\" untuk dzikir setelah shalat\\n`;\n  response += `• Ketik \"kajian\" untuk jadwal pengajian\\n`;\n  response += `• Ketik \"ustadz\" untuk konsultasi`;\n  \n  return response;\n}\n\nconst response = generatePrayerResponse(data);\n\nreturn [{\n  json: {\n    ...data,\n    response: response,\n    response_type: 'PRAYER_SCHEDULE'\n  }\n}];"
      },
      "id": "6",
      "name": "🕌 Prayer Generator",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1200, 400]
    },
    {
      "parameters": {
        "functionCode": "// 🎯 COMPREHENSIVE SERVICE HANDLER\nconst data = $input.all()[0].json;\nconst moment = require('moment');\n\n// Rich service response templates\nconst serviceTemplates = {\n  \n  kiblat_direction: () => `🧭 *ARAH KIBLAT & PANDUAN SHALAT*\\n📍 ${data.masjid.info.nama}\\n\\n🕋 **Arah Kiblat:**\\n📐 **294° dari Utara** (Barat Laut)\\n🧭 Gunakan kompas atau aplikasi kiblat\\n\\n📱 **Aplikasi Kiblat Terpercaya:**\\n• Muslim Pro\\n• Qibla Compass\\n• Adzan Prayer Times\\n• IslamicFinder\\n\\n🕌 **Tips Menentukan Kiblat:**\\n1. Gunakan kompas yang akurat\\n2. Pastikan tidak ada gangguan magnetik\\n3. Konfirmasi dengan aplikasi\\n4. Ikuti jamaah di masjid terdekat\\n\\n📍 **Koordinat Masjid:**\\nLatitude: ${data.masjid.info.coordinates.lat}\\nLongitude: ${data.masjid.info.coordinates.lng}\\n\\n🤲 *\"Wa lillahi al-mashriqu wal-maghrib\"*\\n*\"Milik Allah-lah timur dan barat\"* (QS. Al-Baqarah: 115)`,\n\n  doa_harian: () => `🤲 *DOA & DZIKIR HARIAN*\\n📿 Amalan Sunnah Setiap Hari\\n\\n🌅 **DOA PAGI (Ba'da Subuh):**\\n\\n*أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ*\\n*Ashbahnaa wa ashbahal mulku lillaah*\\n\\n*\"Kami telah memasuki waktu pagi dan kerajaan hanya milik Allah\"*\\n\\n📿 **DZIKIR SETELAH SHALAT:**\\n\\n*سُبْحَانَ اللَّهِ* (33x)\\n*الْحَمْدُ لِلَّهِ* (33x)\\n*اللَّهُ أَكْبَرُ* (34x)\\n\\n🌙 **DOA SORE (Ba'da Ashar):**\\n\\n*أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ*\\n*Amsaynaa wa amsal mulku lillaah*\\n\\n🔄 **ISTIGHFAR HARIAN:**\\n\\n*أَسْتَغْفِرُ اللَّهَ الْعَظِيمَ* (100x)\\n\\n💎 **SAYYIDUL ISTIGHFAR:**\\n\\n*اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ*\\n\\n📖 **Sumber:** HR. Bukhari & Muslim\\n\\n💡 Ketik \"ayat\" untuk ayat Al-Quran random`,\n\n  ayat_quran: () => `📖 *AYAT AL-QURAN PILIHAN*\\n\\n🌟 **QS. Al-Baqarah: 255 (Ayat Kursi)**\\n\\n*اللَّهُ لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ*\\n\\n*\"Allah, tidak ada Tuhan selain Dia Yang Hidup kekal lagi terus menerus mengurus (makhluk-Nya)...\"*\\n\\n🌟 **QS. Al-Ikhlas (1-4)**\\n\\n*قُلْ هُوَ اللَّهُ أَحَدٌ*\\n*اللَّهُ الصَّمَدُ*\\n*لَمْ يَلِدْ وَلَمْ يُولَدْ*\\n*وَلَمْ يَكُنْ لَهُ كُفُوًا أَحَدٌ*\\n\\n*\"Katakanlah: Dia-lah Allah, Yang Maha Esa. Allah adalah Tuhan yang bergantung kepada-Nya segala sesuatu...\"*\\n\\n🌟 **QS. Al-Falaq & An-Nas**\\n📿 Mu'awwidzatain (Dua surah pelindung)\\n\\n💡 Ketik \"hadits\" untuk hadits pilihan`,\n\n  hadits_nabi: () => `☪️ *HADITS RASULULLAH SAW*\\n\\n🌟 **Hadits tentang Akhlak:**\\n\\n📝 Dari Abu Hurairah RA, Rasulullah SAW bersabda:\\n\\n*\"إِنَّمَا بُعِثْتُ لِأُتَمِّمَ صَالِحَ الْأَخْلَاقِ\"*\\n\\n*\"Sesungguhnya aku diutus untuk menyempurnakan akhlak yang baik\"*\\n\\n📚 **HR. Ahmad**\\n\\n🌟 **Hadits tentang Ilmu:**\\n\\n*\"مَنْ سَلَكَ طَرِيقًا يَلْتَمِسُ فِيهِ عِلْمًا سَهَّلَ اللَّهُ لَهُ بِهِ طَرِيقًا إِلَى الْجَنَّةِ\"*\\n\\n*\"Barangsiapa menempuh jalan untuk mencari ilmu, maka Allah akan mudahkan baginya jalan menuju surga\"*\\n\\n📚 **HR. Muslim**\\n\\n🌟 **Hadits tentang Sedekah:**\\n\\n*\"الصَّدَقَةُ تُطْفِئُ الْخَطِيئَةَ كَمَا يُطْفِئُ الْمَاءُ النَّارَ\"*\\n\\n*\"Sedekah dapat menghapus dosa sebagaimana air memadamkan api\"*\\n\\n📚 **HR. Tirmidzi**`,\n\n  kajian_pengajian: () => {\n    const ustadz = data.masjid.ustadz;\n    return `📚 *JADWAL KAJIAN & PENGAJIAN*\\n📍 ${data.masjid.info.nama}\\n\\n📖 **KAJIAN RUTIN MINGGUAN**\\n\\n🟢 **AHAD - Kajian Keluarga**\\n🕘 09:00-11:00 WIB\\n👨‍🏫 ${ustadz[0].nama} & ${ustadz[2].nama}\\n📚 Fiqh Keluarga & Parenting Islami\\n📍 Aula Utama\\n👥 Keluarga (Free)\\n\\n🔵 **SENIN - Tafsir Al-Quran**\\n🕕 19:30-21:00 WIB\\n👨‍🏫 ${ustadz[0].nama}\\n📚 Tafsir Surah Pilihan\\n📍 Ruang Kajian\\n👥 Umum (Free)\\n\\n🟡 **RABU - Fiqh Muamalah**\\n🕗 20:00-21:30 WIB\\n👨‍🏫 ${ustadz[1].nama}\\n📚 Ekonomi Islam Kontemporer\\n📍 Ruang Kajian\\n👥 Umum (Free)\\n\\n🟣 **JUMAT - Kultum Jumatan**\\n🕐 12:30-13:00 WIB\\n👨‍🏫 Ustadz Tamu Mingguan\\n📚 Tema Aktual Keislaman\\n📍 Masjid Utama\\n👥 Jamaah Jumat\\n\\n🔴 **SABTU - Kajian Wanita**\\n🕘 09:00-11:00 WIB\\n👩‍🏫 ${ustadz[2].nama}\\n📚 Fiqh Wanita & Keluarga\\n📍 Ruang Wanita\\n👥 Khusus Wanita\\n\\n📋 **PENDAFTARAN KELAS KHUSUS**\\n\\n🎓 **Tahfidz Al-Quran**\\n📅 Senin-Kamis 16:00-18:00\\n👥 Dewasa & Anak (10+ tahun)\\n💰 Rp 200.000/bulan\\n🎯 Target: 1 Juz/6 bulan\\n\\n📖 **TPQ (Taman Pendidikan Quran)**\\n📅 Selasa-Jumat 15:00-17:00\\n👥 Anak usia 4-12 tahun\\n💰 Rp 150.000/bulan\\n📚 Iqro + Juz Amma\\n\\n🏛️ **Kelas Bahasa Arab**\\n📅 Sabtu 08:00-10:00\\n👥 Remaja & Dewasa\\n💰 Rp 300.000/bulan\\n📖 Nahwu, Sharaf, Conversation\\n\\n📞 **Pendaftaran:**\\n📱 Admin: ${data.masjid.info.whatsapp}\\n📧 Email: ${data.masjid.info.email}\\n🌐 Website: ${data.masjid.info.website}`;\n  },\n\n  tpq_tahfidz: () => `📚 *PENDIDIKAN QURAN UNTUK ANAK*\\n📍 ${data.masjid.info.nama}\\n\\n👶 **TPQ (Taman Pendidikan Quran)**\\n\\n📅 **Jadwal:**\\nSelasa-Jumat: 15:00-17:00 WIB\\nSabtu: 08:00-10:00 WIB\\n\\n👥 **Usia:** 4-12 tahun\\n💰 **Biaya:** Rp 150.000/bulan\\n\\n📖 **Kurikulum:**\\n• Iqro 1-6\\n• Juz Amma (Surah pendek)\\n• Hadits pilihan anak\\n• Doa harian\\n• Akhlak & adab Islam\\n\\n🎓 **TAHFIDZ AL-QURAN**\\n\\n📅 **Jadwal:**\\nSenin-Kamis: 16:00-18:00 WIB\\nSabtu: 08:00-11:00 WIB\\n\\n👥 **Usia:** 10+ tahun (Dewasa welcome)\\n💰 **Biaya:** Rp 200.000/bulan\\n\\n🎯 **Target:**\\n• 1 Juz dalam 6 bulan\\n• Metode talaqqi (setoran langsung)\\n• Muraja'ah (pengulangan) rutin\\n• Tahsin (perbaikan bacaan)\\n\\n👨‍🏫 **Pengajar Berpengalaman:**\\n• Hafidz 30 juz\\n• Bersanad dari Madinah\\n• Metode pembelajaran modern\\n\\n🏆 **Prestasi Alumni:**\\n📜 50+ Hafidz/Hafidzah\\n🎓 Banyak melanjutkan ke pesantren\\n🏅 Juara MTQ tingkat Jakarta\\n\\n📞 **Daftar Sekarang:**\\n📱 ${data.masjid.info.whatsapp}\\n📧 pendidikan@masjidalukhlas.id`,\n\n  konsultasi_syariah: () => {\n    const ustadz = data.masjid.ustadz;\n    return `🤲 *KONSULTASI SYARIAH & BIMBINGAN ROHANI*\\n📍 ${data.masjid.info.nama}\\n\\n👨‍🏫 **TIM USTADZ KONSULTAN BERPENGALAMAN**\\n\\n🟢 **${ustadz[0].nama}**\\n🎓 ${ustadz[0].pendidikan}\\n⭐ Pengalaman: ${ustadz[0].pengalaman}\\n\\n📚 **Spesialisasi:**\\n${ustadz[0].spesialisasi.map(s => `• ${s}`).join('\\n')}\\n\\n⏰ **Jadwal:** ${ustadz[0].jadwal}\\n📱 **Kontak:** ${ustadz[0].kontak}\\n📧 **Email:** ${ustadz[0].email}\\n\\n🔵 **${ustadz[1].nama}**\\n🎓 ${ustadz[1].pendidikan}\\n⭐ Pengalaman: ${ustadz[1].pengalaman}\\n\\n📚 **Spesialisasi:**\\n${ustadz[1].spesialisasi.map(s => `• ${s}`).join('\\n')}\\n\\n⏰ **Jadwal:** ${ustadz[1].jadwal}\\n📱 **Kontak:** ${ustadz[1].kontak}\\n📧 **Email:** ${ustadz[1].email}\\n\\n🟡 **${ustadz[2].nama}**\\n🎓 ${ustadz[2].pendidikan}\\n⭐ Pengalaman: ${ustadz[2].pengalaman}\\n\\n📚 **Spesialisasi:**\\n${ustadz[2].spesialisasi.map(s => `• ${s}`).join('\\n')}\\n\\n⏰ **Jadwal:** ${ustadz[2].jadwal}\\n📱 **Kontak:** ${ustadz[2].kontak}\\n📧 **Email:** ${ustadz[2].email}\\n\\n📋 **KATEGORI KONSULTASI**\\n\\n💒 **Pernikahan & Keluarga**\\n👶 **Parenting Islami**\\n💰 **Ekonomi & Keuangan Syariah**\\n🏢 **Pekerjaan & Karir**\\n🩺 **Kesehatan & Medis**\\n🎓 **Pendidikan & Sosial**\\n\\n📱 **METODE KONSULTASI:**\\n🏢 Tatap muka di masjid\\n📞 Telepon/WhatsApp\\n💻 Video call (Zoom/Meet)\\n📧 Email konsultasi\\n\\n💰 **GRATIS** (Donasi sukarela)\\n⏱️ **Response time:** < 2 jam\\n\\n📞 **Booking:** ${data.masjid.info.whatsapp}`;\n  },\n\n  donasi_infaq: () => {\n    const banks = data.masjid.rekening.banks;\n    const ewallet = data.masjid.rekening.ewallet;\n    return `💰 *DONASI & ZAKAT ${data.masjid.info.nama}*\\n\\n🏦 **REKENING BANK RESMI**\\n\\n💳 **BCA**\\n🔢 ${banks.bca.no}\\n👤 a.n. ${banks.bca.name}\\n\\n💳 **Mandiri**\\n🔢 ${banks.mandiri.no}\\n👤 a.n. ${banks.mandiri.name}\\n\\n💳 **BRI**\\n🔢 ${banks.bri.no}\\n👤 a.n. ${banks.bri.name}\\n\\n📱 **E-WALLET & DIGITAL PAYMENT**\\n\\n💰 **DANA:** ${ewallet.dana}\\n💰 **GoPay:** ${ewallet.gopay}\\n💰 **OVO:** ${ewallet.ovo}\\n💰 **ShopeePay:** ${ewallet.shopeepay}\\n\\n📱 **QRIS Universal:**\\n🔗 ${data.masjid.rekening.qris}\\n\\n💎 **KATEGORI DONASI**\\n\\n🕌 **Operasional Masjid (Rp 50jt/bulan)**\\n• Listrik, air, kebersihan\\n• Gaji imam & staff\\n• Maintenance fasilitas\\n\\n📚 **Pendidikan Islam (Rp 30jt/bulan)**\\n• Gaji ustadz/ustadzah\\n• Buku & materi pembelajaran\\n• Beasiswa anak kurang mampu\\n\\n🤝 **Program Sosial (Rp 25jt/bulan)**\\n• Bantuan fakir miskin\\n• Santunan anak yatim\\n• Ambulans & kesehatan\\n\\n🏗️ **Pembangunan (Rp 100jt/tahun)**\\n• Renovasi & perluasan\\n• Fasilitas baru\\n• Teknologi masjid\\n\\n📊 **KALKULATOR ZAKAT**\\n💰 **Zakat Mal:** 2.5% dari Rp 81.000.000+\\n🌾 **Zakat Profesi:** 2.5% dari gaji Rp 7.000.000+\\n\\n📋 **LAPORAN TRANSPARAN**\\n📊 Dashboard: transparansi.masjidalukhlas.id\\n📱 Update mingguan via WhatsApp\\n📧 Laporan bulanan via email\\n\\n📞 **Konfirmasi Donasi:**\\n📱 ${data.masjid.info.whatsapp}\\n📧 donasi@masjidalukhlas.id\\n\\n🤲 *Jazakumullahu khairan kathiran*`;\n  },\n\n  layanan_jenazah: () => `🕊️ *LAYANAN JENAZAH 24/7*\\n📍 ${data.masjid.info.nama}\\n\\nإِنَّا لِلَّهِ وَإِنَّا إِلَيْهِ رَاجِعُونَ\\n*Innalillahi wa inna ilaihi raji'un*\\n\\n📋 **TIM JENAZAH SIAGA 24 JAM**\\n\\n🔹 **Koordinator Jenazah**\\n👤 H. Bambang Sutrisno\\n📱 +62-815-1234-5678\\n\\n🔹 **Tim Pemandian (Pria)**\\n👤 Ustadz Ahmad Fauzi\\n📱 +62-816-1111-2222\\n\\n🔹 **Tim Pemandian (Wanita)**\\n👤 Ibu Hj. Siti Aminah\\n📱 +62-816-3333-4444\\n\\n🔹 **Tim Kafan & Perlengkapan**\\n👤 Bpk. Muhammad Yusuf\\n📱 +62-817-5555-6666\\n\\n📦 **LAYANAN LENGKAP TERSEDIA:**\\n\\n✅ **Pemandian Jenazah**\\n• Sesuai sunnah Rasulullah\\n• Terpisah pria & wanita\\n• Peralatan steril & lengkap\\n\\n✅ **Kafan Berkualitas**\\n• Kain putih berkualitas tinggi\\n• Sesuai syariat Islam\\n• Ukuran dewasa & anak\\n\\n✅ **Ambulans & Transportasi**\\n• 2 unit ambulans siap 24/7\\n• Sopir berpengalaman\\n• Gratis dalam kota Jakarta\\n\\n✅ **Prosesi Pemakaman**\\n• Shalat jenazah berjamaah\\n• Pengurusan surat-surat\\n• Pendampingan ke TPU\\n\\n✅ **Tahlilan & Doa**\\n• Hari ke-3, 7, 40, 100\\n• Tim qori berpengalaman\\n• Konsumsi sederhana\\n\\n💰 **DONASI SUKARELA**\\n🏦 BCA: ${data.masjid.rekening.banks.bca.no}\\n📱 DANA: ${data.masjid.rekening.ewallet.dana}\\na.n. ${data.masjid.info.nama}\\n\\n🚨 **HOTLINE 24 JAM:**\\n📱 ${data.masjid.info.whatsapp}\\n📞 (021) 1234-5678\\n\\n🤲 *Semoga amal ibadah almarhum/almarhumah diterima Allah SWT*`,\n\n  ambulans_emergency: () => `🚑 *LAYANAN AMBULANS DARURAT*\\n📍 ${data.masjid.info.nama}\\n\\n🆘 **AMBULANS SIAGA 24/7**\\n\\n🚑 **Unit 1 - Ambulans Utama**\\n📱 Call: 0812-AMBULANS-1\\n👨‍⚕️ Driver + Paramedis\\n🏥 Dilengkapi oksigen & P3K\\n\\n🚑 **Unit 2 - Ambulans Cadangan**\\n📱 Call: 0812-AMBULANS-2\\n👨‍⚕️ Driver berpengalaman\\n🏥 Peralatan medis dasar\\n\\n⚡ **RESPONSE TIME:** < 15 menit\\n🎯 **COVERAGE AREA:** Jakarta & sekitarnya\\n💰 **GRATIS** untuk jamaah masjid\\n\\n🏥 **RUMAH SAKIT REKANAN:**\\n• RSUD Fatmawati\\n• RS Siloam Kebayoran\\n• RS Medistra\\n• RS Pondok Indah\\n• RS Jakarta Heart Center\\n\\n📋 **PROSEDUR EMERGENCY:**\\n1. Telepon hotline ambulans\\n2. Berikan alamat lengkap\\n3. Jelaskan kondisi pasien\\n4. Tunggu di lokasi yang mudah diakses\\n5. Siapkan kartu identitas\\n\\n🚨 **KONDISI YANG DILAYANI:**\\n• Serangan jantung\\n• Stroke\\n• Kecelakaan\\n• Sesak napas\\n• Pendarahan\\n• Pingsan\\n• Persalinan darurat\\n\\n📱 **HOTLINE DARURAT:**\\n🚑 ${data.masjid.info.whatsapp}\\n📞 (021) 1234-5678\\n\\n⚠️ **Untuk kondisi kritis:** Langsung call 118/119\\n\\n🤲 Semoga Allah berikan kesembuhan`,\n\n  klinik_kesehatan: () => `🏥 *KLINIK KESEHATAN MASJID*\\n📍 ${data.masjid.info.nama}\\n\\n👩‍⚕️ **PELAYANAN MEDIS**\\n\\n🕐 **Jam Operasional:**\\nSenin-Jumat: 08:00-15:00 WIB\\nSabtu: 08:00-12:00 WIB\\nMinggu: TUTUP (Emergency tetap)\\n\\n👨‍⚕️ **TIM MEDIS:**\\n\\n🩺 **dr. Ahmad Hidayat, Sp.PD**\\n⏰ Senin, Rabu, Jumat: 08:00-12:00\\n📚 Spesialis Penyakit Dalam\\n\\n🩺 **dr. Siti Nurhaliza, Sp.A**\\n⏰ Selasa, Kamis: 08:00-12:00\\n📚 Spesialis Anak\\n\\n🩺 **dr. Muhammad Ridwan**\\n⏰ Senin-Jumat: 13:00-15:00\\n📚 Dokter Umum\\n\\n💊 **LAYANAN TERSEDIA:**\\n\\n✅ **Pemeriksaan Umum**\\n• Konsultasi kesehatan\\n• Cek tekanan darah\\n• Cek gula darah\\n• Cek kolesterol\\n\\n✅ **Pelayanan Anak**\\n• Imunisasi lengkap\\n• Tumbuh kembang\\n• Konsultasi gizi\\n\\n✅ **Kesehatan Wanita**\\n• Konsultasi kehamilan\\n• KB alami\\n• Pemeriksaan ibu hamil\\n\\n✅ **Pengobatan Herbal**\\n• Thibbun Nabawi\\n• Bekam/Hijama\\n• Terapi herbal\\n\\n💰 **TARIF TERJANGKAU:**\\n👥 Jamaah masjid: GRATIS\\n👥 Umum: Rp 25.000\\n💊 Obat: Harga modal\\n\\n📞 **Reservasi & Info:**\\n📱 ${data.masjid.info.whatsapp}\\n📧 klinik@masjidalukhlas.id`,\n\n  cuaca_jakarta: () => `🌤️ *CUACA JAKARTA HARI INI*\\n📅 ${moment().format('dddd, DD MMMM YYYY')}\\n\\n☀️ **Prakiraan Cuaca:**\\n🌡️ Suhu: 28-32°C\\n💧 Kelembaban: 70-85%\\n🌬️ Angin: 5-10 km/h\\n☁️ Kondisi: Berawan sebagian\\n\\n🌧️ **Prediksi Hujan:**\\n🕐 13:00-15:00: 60% kemungkinan\\n🕕 17:00-19:00: 40% kemungkinan\\n🌙 Malam: Cerah berawan\\n\\n🕌 **Tips untuk Jamaah:**\\n• Bawa payung untuk shalat Dzuhur\\n• Gunakan alas kaki yang nyaman\\n• Minum air yang cukup\\n• Wudhu dengan air sejuk\\n\\n⏰ **Update:** ${moment().format('HH:mm')} WIB\\n📡 **Sumber:** BMKG & WeatherAPI\\n\\n💡 Ketik \"jadwal shalat\" untuk waktu shalat hari ini`,\n\n  live_streaming: () => `📺 *LIVE STREAMING MASJID*\\n📍 ${data.masjid.info.nama}\\n\\n🔴 **LIVE STREAMING TERSEDIA:**\\n\\n📱 **Platform Streaming:**\\n• YouTube: Masjid Al-Ikhlas TV\\n• Facebook: @MasjidAlIkhlas\\n• Instagram: @masjidalukhlas\\n• Website: ${data.masjid.info.website}/live\\n\\n🕌 **JADWAL STREAMING RUTIN:**\\n\\n🌅 **Shalat Subuh**\\n🕐 04:30-05:30 WIB\\n📺 Live di semua platform\\n\\n☀️ **Shalat Dzuhur**\\n🕐 12:15-12:45 WIB\\n📺 YouTube & Facebook\\n\\n🌙 **Shalat Magrib**\\n🕐 18:45-19:15 WIB\\n📺 Live di semua platform\\n\\n🕌 **Shalat Jumat**\\n🕐 11:30-13:00 WIB\\n📺 Full coverage + khutbah\\n📱 Interactive chat enabled\\n\\n📚 **KAJIAN LIVE:**\\n🕗 Senin malam: Tafsir Al-Quran\\n🕗 Rabu malam: Fiqh Muamalah\\n🕗 Sabtu pagi: Kajian Wanita\\n\\n🎥 **FITUR STREAMING:**\\n✅ HD Quality (1080p)\\n✅ Audio jernih\\n✅ Multiple camera angles\\n✅ Interactive chat\\n✅ Recording tersedia\\n\\n📊 **STATISTIK:**\\n👥 1000+ viewers rata-rata\\n📈 Growing community\\n💬 Active chat participation\\n\\n🔔 **NOTIFIKASI:**\\nSubscribe & aktifkan bell notification\\nuntuk update streaming terbaru\\n\\n📱 **Info Teknis:**\\n📧 streaming@masjidalukhlas.id\\n📱 ${data.masjid.info.whatsapp}`,\n\n  info_masjid: () => {\n    const masjid = data.masjid;\n    return `🕌 *${masjid.info.nama.toUpperCase()}*\\n*Pusat Ibadah & Dakwah Umat*\\n\\n📍 **INFORMASI LENGKAP**\\n\\n🏠 **Alamat:**\\n${masjid.info.alamat}\\n\\n📊 **Profil Masjid:**\\n📅 Berdiri: ${masjid.info.established}\\n👥 Kapasitas: ${masjid.info.capacity} jamaah\\n📍 Koordinat: ${masjid.info.coordinates.lat}, ${masjid.info.coordinates.lng}\\n\\n📞 **Kontak Resmi:**\\n📱 WhatsApp: ${masjid.info.whatsapp}\\n📧 Email: ${masjid.info.email}\\n🌐 Website: ${masjid.info.website}\\n\\n🏢 **FASILITAS UTAMA:**\\n\\n🕌 **Masjid Utama:**\\n${masjid.fasilitas.utama.map(f => `• ${f}`).join('\\n')}\\n\\n🚿 **Tempat Wudhu:**\\n${masjid.fasilitas.wudhu.map(f => `• ${f}`).join('\\n')}\\n\\n🚻 **Toilet & Sanitasi:**\\n${masjid.fasilitas.toilet.map(f => `• ${f}`).join('\\n')}\\n\\n🅿️ **Area Parkir:**\\n${masjid.fasilitas.parkir.map(f => `• ${f}`).join('\\n')}\\n\\n📚 **Pendidikan:**\\n${masjid.fasilitas.pendidikan.map(f => `• ${f}`).join('\\n')}\\n\\n🏥 **Kesehatan:**\\n${masjid.fasilitas.kesehatan.map(f => `• ${f}`).join('\\n')}\\n\\n🏪 **Fasilitas Lainnya:**\\n${masjid.fasilitas.lainnya.map(f => `• ${f}`).join('\\n')}\\n\\n🕐 **Jam Operasional:**\\nBuka 24 jam untuk ibadah\\nPelayanan admin: 08:00-16:00 WIB\\n\\n🎯 **Visi:**\\nMenjadi pusat ibadah dan dakwah terdepan\\n\\n📋 **Misi:**\\n• Melayani umat dengan excellence\\n• Pendidikan Islam berkualitas\\n• Pemberdayaan ekonomi syariah\\n• Kepedulian sosial berkelanjutan`;\n  },\n\n  salam_greeting: () => {\n    const timeBasedGreeting = () => {\n      const hour = moment().hour();\n      if (hour < 6) return 'dini hari';\n      if (hour < 11) return 'pagi';\n      if (hour < 15) return 'siang';\n      if (hour < 18) return 'sore';\n      return 'malam';\n    };\n    \n    return `وَعَلَيْكُمُ السَّلَامُ وَرَحْمَةُ اللَّهِ وَبَرَكَاتُهُ\\n\\n*Wa'alaikumussalam warahmatullahi wabarakatuh*\\n\\nSelamat ${timeBasedGreeting()} dan selamat datang di\\n🕌 **${data.masjid.info.nama}**\\n\\n📱 **MENU LAYANAN LENGKAP:**\\n\\n🕌 **IBADAH & SPIRITUAL**\\n1️⃣ Jadwal Shalat & Reminder\\n2️⃣ Arah Kiblat & Kompas\\n3️⃣ Doa & Dzikir Harian\\n4️⃣ Ayat Al-Quran Pilihan\\n5️⃣ Hadits Rasulullah\\n\\n📚 **PENDIDIKAN ISLAM**\\n6️⃣ Kajian & Pengajian\\n7️⃣ TPQ & Tahfidz Quran\\n8️⃣ Kelas Bahasa Arab\\n9️⃣ Konsultasi Syariah\\n\\n🤝 **LAYANAN SOSIAL**\\n🔟 Donasi & Zakat\\n1️⃣1️⃣ Program Sosial\\n1️⃣2️⃣ Layanan Jenazah\\n1️⃣3️⃣ Ambulans Emergency\\n1️⃣4️⃣ Klinik Kesehatan\\n\\n ℹ️ **INFORMASI**\\n1️⃣5️⃣ Info Masjid Lengkap\\n1️⃣6️⃣ Cuaca Jakarta\\n1️⃣7️⃣ Live Streaming\\n1️⃣8️⃣ Chat AI Islami\\n\\n💬 **Cara Penggunaan:**\\n• Ketik nama layanan (contoh: \"jadwal shalat\")\\n• Atau langsung chat untuk diskusi\\n• Gunakan kata kunci yang jelas\\n\\n🤖 **AI Assistant siap membantu 24/7!**\\n\\n🕐 Saat ini: ${moment().format('HH:mm')} WIB\\n📅 ${moment().format('dddd, DD MMMM YYYY')}`;\n  }\n};\n\n// Get response based on intent\nconst template = serviceTemplates[data.intent];\nif (!template) {\n  return [{\n    json: {\n      ...data,\n      response: `❌ Service template untuk \"${data.intent}\" belum tersedia. Silakan chat dengan AI atau pilih menu lainnya.`,\n      response_type: 'TEMPLATE_NOT_FOUND'\n    }\n  }];\n}\n\nconst response = template();\n\nreturn [{\n  json: {\n    ...data,\n    response: response,\n    response_type: 'SERVICE_TEMPLATE'\n  }\n}];"
      },
      "id": "7",
      "name": "🎯 Service Handler",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1200, 600]
    },
    {
      "parameters": {
        "url": "https://api.fonnte.com/send",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "YOUR_WHATSAPP_API_KEY"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "target",
              "value": "={{ $json.phone }}"
            },
            {
              "name": "message",
              "value": "={{ $json.response }}"
            },
            {
              "name": "countryCode",
              "value": "62"
            }
          ]
        }
      },
      "id": "8",
      "name": "📤 WhatsApp Sender",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1450, 500]
    },
    {
      "parameters": {
        "url": "={{ $json.config.apis.supabase_url }}/rest/v1/chat_analytics",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $json.config.apis.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "Bearer {{ $json.config.apis.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=minimal"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "user_phone",
              "value": "={{ $json.phone }}"
            },
            {
              "name": "intent",
              "value": "={{ $json.intent }}"
            },
            {
              "name": "confidence",
              "value": "={{ $json.confidence || 0 }}"
            },
            {
              "name": "response_type",
              "value": "={{ $json.response_type }}"
            },
            {
              "name": "message_type",
              "value": "={{ $json.messageType }}"
            },
            {
              "name": "processing_time",
              "value": "={{ $json.processing_time }}"
            },
            {
              "name": "timestamp",
              "value": "={{ $json.timestamp }}"
            },
            {
              "name": "day_name",
              "value": "={{ $json.day_name }}"
            },
            {
              "name": "is_friday",
              "value": "={{ $json.is_friday }}"
            },
            {
              "name": "is_prayer_time",
              "value": "={{ $json.is_prayer_time }}"
            },
            {
              "name": "ai_model",
              "value": "={{ $json.ai_model || 'none' }}"
            },
            {
              "name": "ai_tokens",
              "value": "={{ $json.ai_tokens || 0 }}"
            }
          ]
        }
      },
      "id": "9",
      "name": "📊 Analytics Logger",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1450, 600]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ {\n  \"success\": true,\n  \"message\": \"Advanced workflow completed successfully\",\n  \"data\": {\n    \"phone\": $json.phone,\n    \"intent\": $json.intent,\n    \"confidence\": $json.confidence || 0,\n    \"response_type\": $json.response_type,\n    \"processing_time\": $json.processing_time + \"ms\",\n    \"timestamp\": $json.timestamp,\n    \"ai_powered\": $json.ai_model ? true : false\n  },\n  \"features\": {\n    \"smart_classification\": true,\n    \"context_aware\": true,\n    \"multi_provider_whatsapp\": true,\n    \"rich_services\": true,\n    \"ai_chat\": true,\n    \"analytics\": true\n  }\n} }}"
      },
      "id": "10",
      "name": "✅ Success Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1700, 550]
    }
  ],
  "connections": {
    "📱 WhatsApp Gateway": {
      "main": [
        [
          {
            "node": "🧠 Smart Classifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "🧠 Smart Classifier": {
      "main": [
        [
          {
            "node": "🤖 Need AI?",
            "type": "main",
            "index": 0
          },
          {
            "node": "🕌 Prayer Service?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "🤖 Need AI?": {
      "main": [
        [
          {
            "node": "🤖 AI Chat Engine",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "🕌 Prayer Service?": {
      "main": [
        [
          {
            "node": "🕌 Prayer Generator",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "🎯 Service Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "🤖 AI Chat Engine": {
      "main": [
        [
          {
            "node": "📤 WhatsApp Sender",
            "type": "main",
            "index": 0
          },
          {
            "node": "📊 Analytics Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "🕌 Prayer Generator": {
      "main": [
        [
          {
            "node": "📤 WhatsApp Sender",
            "type": "main",
            "index": 0
          },
          {
            "node": "📊 Analytics Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "🎯 Service Handler": {
      "main": [
        [
          {
            "node": "📤 WhatsApp Sender",
            "type": "main",
            "index": 0
          },
          {
            "node": "📊 Analytics Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "📤 WhatsApp Sender": {
      "main": [
        [
          {
            "node": "✅ Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "📊 Analytics Logger": {
      "main": [
        [
          {
            "node": "✅ Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3.0",
  "id": "masjid-ai-advanced-workflow",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "tags": [
    {
      "id": "advanced-features",
      "name": "Advanced Features"
    },
    {
      "id": "masjid-ai",
      "name": "Masjid AI"
    },
    {
      "id": "rich-services",
      "name": "Rich Services"
    },
    {
      "id": "smart-classification",
      "name": "Smart Classification"
    }
  ]
}