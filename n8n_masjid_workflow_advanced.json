{
  "name": "Masjid AI Advanced Workflow - Rich Features",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "webhook-masjid-ai",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "1",
      "name": "ğŸ“± WhatsApp Gateway",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [200, 400]
    },
    {
      "parameters": {
        "functionCode": "// ğŸš€ ADVANCED MESSAGE PROCESSOR & INTELLIGENT CLASSIFIER\nconst moment = require('moment');\n\n// Configuration with Rich Features\nconst CONFIG = {\n  apis: {\n    openrouter: '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',\n    supabase_url: 'https://bvaxxlmhrzocbrqiykoqul.supabase.co',\n    supabase_key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ2YXh4bG1ocnpvY2JycWl5a29xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjMxMDMsImV4cCI6MjA2OTQzOTEwM30.GjDhx8BUR7Y4FUS2PZalEeDhKVt_zQWGTEV_5nKKgrg',\n    prayer_api: 'https://api.aladhan.com/v1/timingsByCity?city=Jakarta&country=Indonesia',\n    weather_api: 'https://api.openweathermap.org/data/2.5/weather?q=Jakarta&appid=demo&units=metric',\n    qiblat_api: 'https://api.aladhan.com/v1/qibla/Jakarta/Indonesia',\n    hadits_api: 'https://hadits-api-id.vercel.app/hadith',\n    quran_api: 'https://api.quran.com/api/v4/verses/random'\n  },\n  ai_models: {\n    primary: 'moonshotai/kimi-k2:free',\n    fallback: 'google/gemma-7b-it:free'\n  }\n};\n\n// Masjid Complete Information\nconst MASJID = {\n  info: {\n    nama: 'Masjid Al-Ikhlas',\n    alamat: 'Jl. Raya Masjid No. 123, Jakarta Selatan 12345',\n    coordinates: { lat: -6.2088, lng: 106.8456 },\n    whatsapp: '+62-812-3456-7890',\n    email: 'info@masjidalukhlas.id',\n    website: 'https://masjidalukhlas.id',\n    established: '15 Maret 1985',\n    capacity: 2000\n  },\n  \n  rekening: {\n    banks: {\n      bca: { no: '1234567890', name: 'Masjid Al-Ikhlas' },\n      mandiri: { no: '0987654321', name: 'Yayasan Masjid Al-Ikhlas' },\n      bri: { no: '5555666677778888', name: 'Takmir Masjid Al-Ikhlas' }\n    },\n    ewallet: {\n      dana: '081234567890',\n      gopay: '081234567890',\n      ovo: '081234567890',\n      shopeepay: '081234567890'\n    },\n    qris: 'https://example.com/qris-masjid.png'\n  },\n  \n  ustadz: [\n    {\n      nama: 'Ustadz Dr. Ahmad Dahlan, Lc., M.A',\n      spesialisasi: ['Fiqh Ibadah', 'Akhlaq & Tasawuf', 'Tafsir Al-Quran', 'Resolusi Konflik'],\n      jadwal: 'Senin-Kamis 19:00-21:00, Jumat 08:00-11:00, Sabtu 14:00-17:00',\n      kontak: '+62-813-1111-2222',\n      email: 'ahmad@masjidalukhlas.id',\n      pendidikan: 'Lulusan Al-Azhar University, Kairo',\n      pengalaman: '15+ tahun'\n    },\n    {\n      nama: 'Ustadz Muhammad Ridwan, S.H.I., M.E.I',\n      spesialisasi: ['Ekonomi Syariah', 'Hukum Keluarga', 'Parenting Islami', 'Entrepreneurship Halal'],\n      jadwal: 'Selasa-Jumat 08:00-12:00, Sabtu 19:00-21:00, Minggu 09:00-11:00',\n      kontak: '+62-813-3333-4444',\n      email: 'ridwan@masjidalukhlas.id',\n      pendidikan: 'Lulusan UIN Jakarta & Malaysia',\n      pengalaman: '12+ tahun'\n    },\n    {\n      nama: 'Ustadzah Dr. Aisyah Mahmud, Lc., M.Pd',\n      spesialisasi: ['Konsultasi Wanita', 'Pendidikan Anak', 'Kesehatan Reproduksi Syariah', 'Psikologi Islam'],\n      jadwal: 'Rabu-Jumat 14:00-17:00, Sabtu 09:00-12:00 (Khusus wanita)',\n      kontak: '+62-814-4444-5555',\n      email: 'aisyah@masjidalukhlas.id',\n      pendidikan: 'Lulusan Universitas Madinah',\n      pengalaman: '10+ tahun'\n    }\n  ],\n  \n  fasilitas: {\n    utama: ['Masjid 2000 jamaah', 'AC Central', 'Sound System Digital', 'Karpet Premium', 'Mihrab Marmer'],\n    wudhu: ['40 kran pria', '35 kran wanita', 'Air hangat', 'Sabun & tissue'],\n    toilet: ['15 toilet pria', '12 toilet wanita', 'Fasilitas difabel', 'Baby changing room'],\n    parkir: ['500 motor', '200 mobil', 'Security 24/7', 'CCTV monitoring'],\n    pendidikan: ['8 ruang kelas ber-AC', 'Proyektor', 'Perpustakaan 5000+ buku', 'Lab komputer'],\n    kesehatan: ['Klinik umum', 'Apotek mini', 'Ruang konseling', 'Ambulans'],\n    lainnya: ['Dapur modern', 'Aula 500 orang', 'Toko koperasi', 'ATM center']\n  }\n};\n\n// Rich Prayer Times with Dynamic Features\nfunction getPrayerTimes() {\n  const now = moment();\n  const times = {\n    fajr: '04:30',\n    sunrise: '05:45', \n    dhuhr: '12:15',\n    asr: '15:30',\n    maghrib: '18:45',\n    isha: '20:00'\n  };\n  \n  // Calculate next prayer\n  const currentHour = now.hour();\n  const currentMinute = now.minute();\n  const currentTime = currentHour * 60 + currentMinute;\n  \n  const prayerMinutes = {\n    fajr: 4 * 60 + 30,\n    dhuhr: 12 * 60 + 15,\n    asr: 15 * 60 + 30,\n    maghrib: 18 * 60 + 45,\n    isha: 20 * 60 + 0\n  };\n  \n  let nextPrayer = 'Subuh';\n  let nextTime = '04:30';\n  let countdown = '';\n  \n  for (const [prayer, minutes] of Object.entries(prayerMinutes)) {\n    if (currentTime < minutes) {\n      nextPrayer = prayer === 'fajr' ? 'Subuh' : \n                   prayer === 'dhuhr' ? 'Dzuhur' :\n                   prayer === 'asr' ? 'Ashar' :\n                   prayer === 'maghrib' ? 'Magrib' : 'Isya';\n      nextTime = times[prayer];\n      const remaining = minutes - currentTime;\n      const hours = Math.floor(remaining / 60);\n      const mins = remaining % 60;\n      countdown = `${hours}h ${mins}m`;\n      break;\n    }\n  }\n  \n  return { times, nextPrayer, nextTime, countdown };\n}\n\n// Advanced Intent Classification with Context\nfunction classifyIntent(message, context = {}) {\n  const msg = message.toLowerCase();\n  const time = moment();\n  const hour = time.hour();\n  const day = time.day(); // 0=Sunday, 5=Friday\n  \n  // Advanced intent patterns with smart scoring\n  const intents = {\n    // Core Religious Services\n    jadwal_shalat: {\n      keywords: ['jadwal shalat', 'waktu shalat', 'adzan', 'subuh', 'dzuhur', 'ashar', 'magrib', 'isya', 'prayer time'],\n      score: hour >= 4 && hour <= 20 ? 10 : 7\n    },\n    \n    kiblat_direction: {\n      keywords: ['kiblat', 'qibla', 'arah shalat', 'direction', 'compass'],\n      score: 8\n    },\n    \n    doa_harian: {\n      keywords: ['doa', 'dzikir', 'wirid', 'tasbih', 'istighfar', 'daily prayer'],\n      score: 9\n    },\n    \n    ayat_quran: {\n      keywords: ['ayat', 'quran', 'alquran', 'surah', 'verse', 'bacaan'],\n      score: 9\n    },\n    \n    hadits_nabi: {\n      keywords: ['hadits', 'hadith', 'sunnah', 'nabi', 'rasul', 'prophet'],\n      score: 8\n    },\n    \n    // Educational & Learning\n    kajian_pengajian: {\n      keywords: ['kajian', 'pengajian', 'ceramah', 'kuliah', 'ustadz', 'belajar islam', 'study'],\n      score: day === 5 ? 10 : 7 // Higher on Friday\n    },\n    \n    tpq_tahfidz: {\n      keywords: ['tpq', 'tahfidz', 'mengaji', 'belajar quran', 'hafalan', 'ngaji anak'],\n      score: 8\n    },\n    \n    kelas_bahasa_arab: {\n      keywords: ['bahasa arab', 'arabic', 'belajar arab', 'kursus arab', 'nahwu', 'sharaf'],\n      score: 7\n    },\n    \n    // Consultation Services\n    konsultasi_syariah: {\n      keywords: ['konsultasi', 'tanya ustadz', 'fatwa', 'hukum islam', 'syariah', 'fiqh'],\n      score: 9\n    },\n    \n    konsultasi_keluarga: {\n      keywords: ['keluarga', 'pernikahan', 'suami istri', 'anak', 'parenting', 'rumah tangga'],\n      score: 8\n    },\n    \n    konsultasi_ekonomi: {\n      keywords: ['ekonomi', 'bisnis', 'investasi', 'saham', 'trading', 'keuangan', 'halal haram'],\n      score: 8\n    },\n    \n    // Community Services\n    donasi_infaq: {\n      keywords: ['donasi', 'infaq', 'sedekah', 'zakat', 'transfer', 'rekening', 'qris', 'bayar'],\n      score: 8\n    },\n    \n    program_sosial: {\n      keywords: ['sosial', 'bantuan', 'dhuafa', 'yatim', 'fakir miskin', 'beasiswa', 'santunan'],\n      score: 7\n    },\n    \n    layanan_jenazah: {\n      keywords: ['jenazah', 'meninggal', 'kafan', 'pemakaman', 'tahlil', 'doa mayit', 'funeral'],\n      score: 10\n    },\n    \n    ambulans_emergency: {\n      keywords: ['ambulans', 'emergency', 'darurat', 'sakit', 'rumah sakit', 'urgent'],\n      score: 10\n    },\n    \n    // Administrative\n    daftar_nikah: {\n      keywords: ['nikah', 'menikah', 'akad', 'pernikahan', 'wedding', 'marriage'],\n      score: 8\n    },\n    \n    sewa_gedung: {\n      keywords: ['sewa', 'gedung', 'aula', 'acara', 'event', 'rent'],\n      score: 6\n    },\n    \n    info_masjid: {\n      keywords: ['info', 'alamat', 'lokasi', 'kontak', 'jam buka', 'fasilitas', 'about'],\n      score: 6\n    },\n    \n    // Health & Wellness\n    klinik_kesehatan: {\n      keywords: ['klinik', 'dokter', 'kesehatan', 'berobat', 'medical', 'health'],\n      score: 7\n    },\n    \n    ruqyah_thibbun: {\n      keywords: ['ruqyah', 'thibbun nabawi', 'pengobatan islam', 'herbal', 'bekam', 'hijama'],\n      score: 7\n    },\n    \n    // Modern Features\n    cuaca_jakarta: {\n      keywords: ['cuaca', 'weather', 'hujan', 'panas', 'temperature', 'iklim'],\n      score: 5\n    },\n    \n    live_streaming: {\n      keywords: ['live', 'streaming', 'online', 'youtube', 'broadcast', 'virtual'],\n      score: hour >= 11 && hour <= 13 ? 8 : 6 // Higher during Jumatan\n    },\n    \n    reminder_notification: {\n      keywords: ['reminder', 'notifikasi', 'alarm', 'ingat', 'notification'],\n      score: 7\n    },\n    \n    // AI Interactive\n    ai_chat_islamic: {\n      keywords: ['tanya', 'bagaimana', 'kenapa', 'apa itu', 'jelaskan', 'chat', 'diskusi'],\n      score: 6\n    },\n    \n    translate_arabic: {\n      keywords: ['translate', 'terjemah', 'arabic', 'artinya', 'meaning'],\n      score: 7\n    },\n    \n    // Social\n    salam_greeting: {\n      keywords: ['assalamualaikum', 'salam', 'halo', 'hai', 'selamat'],\n      score: hour < 6 || hour > 21 ? 4 : 6\n    }\n  };\n  \n  // Find best match\n  let bestMatch = { intent: 'ai_chat_islamic', score: 0 };\n  \n  for (const [intent, config] of Object.entries(intents)) {\n    const matches = config.keywords.filter(keyword => msg.includes(keyword)).length;\n    const totalScore = matches * config.score;\n    \n    if (totalScore > bestMatch.score) {\n      bestMatch = { intent, score: totalScore, confidence: Math.min(totalScore / 10, 1) };\n    }\n  }\n  \n  return bestMatch;\n}\n\n// Smart Message Parser\nfunction parseMessage(body) {\n  let phone, message, messageType, mediaUrl, timestamp;\n  \n  // Multiple WhatsApp provider support\n  if (body.entry && body.entry[0]?.changes?.[0]?.value?.messages) {\n    // WhatsApp Business API\n    const msg = body.entry[0].changes[0].value.messages[0];\n    phone = msg.from;\n    messageType = msg.type;\n    message = msg.text?.body || `[${messageType}]`;\n    mediaUrl = msg.image?.id || msg.audio?.id || msg.video?.id;\n    timestamp = msg.timestamp;\n  } else if (body.device && body.message) {\n    // Fonnte\n    phone = body.device;\n    message = body.message;\n    messageType = body.message_type || 'text';\n    mediaUrl = body.file;\n    timestamp = body.date;\n  } else if (body.from && body.body) {\n    // Woowa\n    phone = body.from;\n    message = body.body;\n    messageType = body.type || 'text';\n    mediaUrl = body.media_url;\n    timestamp = body.timestamp;\n  } else if (body.phone && body.message) {\n    // Generic\n    phone = body.phone;\n    message = body.message;\n    messageType = body.type || 'text';\n    mediaUrl = body.media_url;\n    timestamp = body.timestamp || Date.now();\n  }\n  \n  return { phone, message, messageType, mediaUrl, timestamp };\n}\n\n// Clean phone number\nfunction cleanPhone(phone) {\n  if (!phone) return null;\n  phone = phone.replace(/[^0-9+]/g, '');\n  if (phone.startsWith('0')) phone = '+62' + phone.substring(1);\n  else if (phone.startsWith('62')) phone = '+' + phone;\n  else if (!phone.startsWith('+')) phone = '+62' + phone;\n  return phone;\n}\n\n// Main Processing\nconst startTime = Date.now();\nconst body = $input.all()[0].body;\n\nconst parsed = parseMessage(body);\nlet { phone, message, messageType, mediaUrl, timestamp } = parsed;\n\nphone = cleanPhone(phone);\n\nif (!phone || !message) {\n  return [{\n    json: {\n      error: 'Invalid input',\n      hasError: true,\n      phone: phone || 'unknown',\n      message: message || 'empty'\n    }\n  }];\n}\n\n// Classify intent\nconst classification = classifyIntent(message);\nconst prayerData = getPrayerTimes();\n\n// Prepare rich output\nreturn [{\n  json: {\n    // Core data\n    phone: phone,\n    message: message,\n    messageType: messageType,\n    mediaUrl: mediaUrl,\n    timestamp: timestamp || new Date().toISOString(),\n    \n    // Classification\n    intent: classification.intent,\n    confidence: classification.confidence,\n    score: classification.score,\n    \n    // Context\n    prayer_data: prayerData,\n    current_time: moment().format('HH:mm'),\n    current_date: moment().format('DD/MM/YYYY'),\n    day_name: moment().format('dddd'),\n    is_friday: moment().day() === 5,\n    is_prayer_time: [4, 12, 15, 18, 20].includes(moment().hour()),\n    \n    // Processing\n    processing_time: Date.now() - startTime,\n    hasError: false,\n    \n    // Config\n    config: CONFIG,\n    masjid: MASJID\n  }\n}];"
      },
      "id": "2",
      "name": "ğŸ§  Smart Classifier",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 400]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.intent }}",
              "operation": "equal",
              "value2": "ai_chat_islamic"
            }
          ]
        }
      },
      "id": "3",
      "name": "ğŸ¤– Need AI?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [700, 400]
    },
    {
      "parameters": {
        "functionCode": "// ğŸ¤– ADVANCED AI CHAT PROCESSOR\nconst data = $input.all()[0].json;\n\n// Enhanced Islamic AI Assistant\nasync function generateAIResponse(message, context) {\n  const systemPrompt = `Anda adalah AI Assistant Masjid ${context.masjid.info.nama}, asisten cerdas untuk umat Islam. \n\nKARAKTER:\n- Berpengetahuan luas tentang Islam (Al-Quran, Hadits, Fiqh, Sejarah)\n- Bijaksana, sabar, dan penuh empati dalam menjawab\n- Menggunakan bahasa Indonesia yang mudah dipahami\n- Selalu sopan dan santun dalam berinteraksi\n- Memberikan jawaban yang praktis dan aplikatif\n\nKONTEKS WAKTU:\n- Hari: ${context.day_name}\n- Tanggal: ${context.current_date}\n- Waktu: ${context.current_time} WIB\n- Shalat selanjutnya: ${context.prayer_data.nextPrayer} (${context.prayer_data.nextTime})\n\nINFORMASI MASJID:\n- Nama: ${context.masjid.info.nama}\n- Alamat: ${context.masjid.info.alamat}\n- WhatsApp: ${context.masjid.info.whatsapp}\n- Berdiri: ${context.masjid.info.established}\n- Kapasitas: ${context.masjid.info.capacity} jamaah\n\nUSTADZ TERSEDIA:\n${context.masjid.ustadz.map(u => `- ${u.nama} (${u.spesialisasi.join(', ')}) - ${u.jadwal}`).join('\\n')}\n\nPEDOMAN:\nâœ… Gunakan emoji yang relevan dan menarik\nâœ… Berikan jawaban yang terstruktur dan mudah dibaca\nâœ… Sertakan dalil Al-Quran atau Hadits jika relevan\nâœ… Rujuk ke ustadz untuk pertanyaan fiqh yang kompleks\nâœ… Berikan saran praktis yang bisa diterapkan\nâœ… Akhiri dengan doa atau motivasi Islami\nâŒ Jangan memberikan fatwa tanpa dasar yang kuat\nâŒ Hindari pembahasan politik atau SARA\nâŒ Jangan berlebihan dalam klaim atau janji`;\n\n  try {\n    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${context.config.apis.openrouter}`,\n        'Content-Type': 'application/json',\n        'HTTP-Referer': 'https://masjidalukhlas.id',\n        'X-Title': 'Masjid AI Assistant'\n      },\n      body: JSON.stringify({\n        model: context.config.ai_models.primary,\n        messages: [\n          { role: 'system', content: systemPrompt },\n          { role: 'user', content: message }\n        ],\n        max_tokens: 1500,\n        temperature: 0.7,\n        top_p: 0.9\n      })\n    });\n    \n    if (response.ok) {\n      const result = await response.json();\n      let aiResponse = result.choices[0].message.content;\n      \n      // Add Islamic greeting if not present\n      if (!aiResponse.includes('ğŸ¤²') && !aiResponse.includes('Ø§Ù„Ø³Ù„Ø§Ù…')) {\n        aiResponse = 'ğŸ¤² ' + aiResponse;\n      }\n      \n      // Add helpful suggestions\n      aiResponse += `\\n\\nğŸ’¡ **Saran Lainnya:**\\nâ€¢ Ketik \"jadwal shalat\" untuk waktu shalat\\nâ€¢ Ketik \"tanya ustadz\" untuk konsultasi\\nâ€¢ Ketik \"doa\" untuk dzikir harian\\nâ€¢ Ketik \"info masjid\" untuk informasi lengkap`;\n      \n      return {\n        response: aiResponse,\n        model_used: context.config.ai_models.primary,\n        tokens: result.usage?.total_tokens || 0,\n        status: 'success'\n      };\n    } else {\n      throw new Error('AI API Error');\n    }\n  } catch (error) {\n    // Fallback response\n    return {\n      response: `ğŸ¤– Maaf, saya sedang mengalami gangguan teknis. \\n\\nUntuk bantuan segera:\\nğŸ‘¨â€ğŸ« Ustadz Ahmad: ${context.masjid.ustadz[0].kontak}\\nğŸ‘¨â€ğŸ« Ustadz Ridwan: ${context.masjid.ustadz[1].kontak}\\nğŸ“± Admin: ${context.masjid.info.whatsapp}\\n\\nğŸ”„ Silakan coba lagi dalam beberapa menit.`,\n      model_used: 'fallback',\n      tokens: 0,\n      status: 'error'\n    };\n  }\n}\n\nconst result = await generateAIResponse(data.message, data);\n\nreturn [{\n  json: {\n    ...data,\n    response: result.response,\n    ai_model: result.model_used,\n    ai_tokens: result.tokens,\n    ai_status: result.status,\n    response_type: 'AI_GENERATED'\n  }\n}];"
      },
      "id": "4",
      "name": "ğŸ¤– AI Chat Engine",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [950, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.intent }}",
              "operation": "equal",
              "value2": "jadwal_shalat"
            }
          ]
        }
      },
      "id": "5",
      "name": "ğŸ•Œ Prayer Service?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [950, 500]
    },
    {
      "parameters": {
        "functionCode": "// ğŸ•Œ ADVANCED PRAYER TIME SERVICE\nconst data = $input.all()[0].json;\nconst moment = require('moment');\n\nfunction generatePrayerResponse(data) {\n  const prayerData = data.prayer_data;\n  const masjid = data.masjid;\n  const now = moment();\n  \n  let response = `ğŸ•Œ *JADWAL SHALAT HARI INI*\\nğŸ“… ${now.format('dddd, DD MMMM YYYY')}\\nğŸ“ ${masjid.info.nama}\\n\\n`;\n  \n  // Prayer times with status\n  const times = prayerData.times;\n  const currentHour = now.hour();\n  \n  response += `ğŸŒ… **Subuh:** ${times.fajr} WIB ${currentHour < 4 ? 'â°' : currentHour < 6 ? 'âœ…' : 'âœ…'}\\n`;\n  response += `ğŸŒ„ **Terbit:** ${times.sunrise} WIB\\n`;\n  response += `â˜€ï¸ **Dzuhur:** ${times.dhuhr} WIB ${currentHour < 12 ? 'â°' : currentHour < 13 ? 'âœ…' : 'âœ…'}\\n`;\n  response += `ğŸŒ¤ï¸ **Ashar:** ${times.asr} WIB ${currentHour < 15 ? 'â°' : currentHour < 16 ? 'âœ…' : 'âœ…'}\\n`;\n  response += `ğŸŒ… **Magrib:** ${times.maghrib} WIB ${currentHour < 18 ? 'â°' : currentHour < 19 ? 'âœ…' : 'âœ…'}\\n`;\n  response += `ğŸŒ™ **Isya:** ${times.isha} WIB ${currentHour < 20 ? 'â°' : 'âœ…'}\\n\\n`;\n  \n  // Next prayer info\n  response += `â° **Shalat Selanjutnya:** ${prayerData.nextPrayer}\\n`;\n  response += `ğŸ• **Waktu:** ${prayerData.nextTime} WIB\\n`;\n  if (prayerData.countdown) {\n    response += `â³ **Countdown:** ${prayerData.countdown}\\n\\n`;\n  }\n  \n  // Additional info\n  response += `ğŸ•‹ **Info Kiblat:** 294Â° dari Utara\\n`;\n  response += `ğŸ“± **Reminder:** Ketik \"reminder on\" untuk notifikasi\\n`;\n  response += `ğŸ“ **Lokasi Masjid:** ${masjid.info.alamat}\\n\\n`;\n  \n  // Quranic verse\n  response += `ğŸ¤² *\"Aqiimu ash-shalata li dhikrii\"*\\n*\"Dirikanlah shalat untuk mengingat-Ku\"* (QS. Thaha: 14)\\n\\n`;\n  \n  // Quick actions\n  response += `ğŸ’¡ **Menu Cepat:**\\n`;\n  response += `â€¢ Ketik \"kiblat\" untuk arah kiblat\\n`;\n  response += `â€¢ Ketik \"doa\" untuk dzikir setelah shalat\\n`;\n  response += `â€¢ Ketik \"kajian\" untuk jadwal pengajian\\n`;\n  response += `â€¢ Ketik \"ustadz\" untuk konsultasi`;\n  \n  return response;\n}\n\nconst response = generatePrayerResponse(data);\n\nreturn [{\n  json: {\n    ...data,\n    response: response,\n    response_type: 'PRAYER_SCHEDULE'\n  }\n}];"
      },
      "id": "6",
      "name": "ğŸ•Œ Prayer Generator",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1200, 400]
    },
    {
      "parameters": {
        "functionCode": "// ğŸ¯ COMPREHENSIVE SERVICE HANDLER\nconst data = $input.all()[0].json;\nconst moment = require('moment');\n\n// Rich service response templates\nconst serviceTemplates = {\n  \n  kiblat_direction: () => `ğŸ§­ *ARAH KIBLAT & PANDUAN SHALAT*\\nğŸ“ ${data.masjid.info.nama}\\n\\nğŸ•‹ **Arah Kiblat:**\\nğŸ“ **294Â° dari Utara** (Barat Laut)\\nğŸ§­ Gunakan kompas atau aplikasi kiblat\\n\\nğŸ“± **Aplikasi Kiblat Terpercaya:**\\nâ€¢ Muslim Pro\\nâ€¢ Qibla Compass\\nâ€¢ Adzan Prayer Times\\nâ€¢ IslamicFinder\\n\\nğŸ•Œ **Tips Menentukan Kiblat:**\\n1. Gunakan kompas yang akurat\\n2. Pastikan tidak ada gangguan magnetik\\n3. Konfirmasi dengan aplikasi\\n4. Ikuti jamaah di masjid terdekat\\n\\nğŸ“ **Koordinat Masjid:**\\nLatitude: ${data.masjid.info.coordinates.lat}\\nLongitude: ${data.masjid.info.coordinates.lng}\\n\\nğŸ¤² *\"Wa lillahi al-mashriqu wal-maghrib\"*\\n*\"Milik Allah-lah timur dan barat\"* (QS. Al-Baqarah: 115)`,\n\n  doa_harian: () => `ğŸ¤² *DOA & DZIKIR HARIAN*\\nğŸ“¿ Amalan Sunnah Setiap Hari\\n\\nğŸŒ… **DOA PAGI (Ba'da Subuh):**\\n\\n*Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ ÙˆÙØ£ÙØµÙ’Ø¨ÙØ­Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙÙ‘Ù‡Ù*\\n*Ashbahnaa wa ashbahal mulku lillaah*\\n\\n*\"Kami telah memasuki waktu pagi dan kerajaan hanya milik Allah\"*\\n\\nğŸ“¿ **DZIKIR SETELAH SHALAT:**\\n\\n*Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù* (33x)\\n*Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù* (33x)\\n*Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù* (34x)\\n\\nğŸŒ™ **DOA SORE (Ba'da Ashar):**\\n\\n*Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ ÙˆÙØ£ÙÙ…Ù’Ø³ÙÙ‰ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙÙ‘Ù‡Ù*\\n*Amsaynaa wa amsal mulku lillaah*\\n\\nğŸ”„ **ISTIGHFAR HARIAN:**\\n\\n*Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù* (100x)\\n\\nğŸ’ **SAYYIDUL ISTIGHFAR:**\\n\\n*Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ†Ù’ØªÙ Ø±ÙØ¨ÙÙ‘ÙŠ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø£ÙÙ†Ù’ØªÙ*\\n\\nğŸ“– **Sumber:** HR. Bukhari & Muslim\\n\\nğŸ’¡ Ketik \"ayat\" untuk ayat Al-Quran random`,\n\n  ayat_quran: () => `ğŸ“– *AYAT AL-QURAN PILIHAN*\\n\\nğŸŒŸ **QS. Al-Baqarah: 255 (Ayat Kursi)**\\n\\n*Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù*\\n\\n*\"Allah, tidak ada Tuhan selain Dia Yang Hidup kekal lagi terus menerus mengurus (makhluk-Nya)...\"*\\n\\nğŸŒŸ **QS. Al-Ikhlas (1-4)**\\n\\n*Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ­ÙØ¯ÙŒ*\\n*Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„ØµÙÙ‘Ù…ÙØ¯Ù*\\n*Ù„ÙÙ…Ù’ ÙŠÙÙ„ÙØ¯Ù’ ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙˆÙ„ÙØ¯Ù’*\\n*ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙƒÙÙ†Ù’ Ù„ÙÙ‡Ù ÙƒÙÙÙÙˆÙ‹Ø§ Ø£ÙØ­ÙØ¯ÙŒ*\\n\\n*\"Katakanlah: Dia-lah Allah, Yang Maha Esa. Allah adalah Tuhan yang bergantung kepada-Nya segala sesuatu...\"*\\n\\nğŸŒŸ **QS. Al-Falaq & An-Nas**\\nğŸ“¿ Mu'awwidzatain (Dua surah pelindung)\\n\\nğŸ’¡ Ketik \"hadits\" untuk hadits pilihan`,\n\n  hadits_nabi: () => `â˜ªï¸ *HADITS RASULULLAH SAW*\\n\\nğŸŒŸ **Hadits tentang Akhlak:**\\n\\nğŸ“ Dari Abu Hurairah RA, Rasulullah SAW bersabda:\\n\\n*\"Ø¥ÙÙ†ÙÙ‘Ù…ÙØ§ Ø¨ÙØ¹ÙØ«Ù’ØªÙ Ù„ÙØ£ÙØªÙÙ…ÙÙ‘Ù…Ù ØµÙØ§Ù„ÙØ­Ù Ø§Ù„Ù’Ø£ÙØ®Ù’Ù„ÙØ§Ù‚Ù\"*\\n\\n*\"Sesungguhnya aku diutus untuk menyempurnakan akhlak yang baik\"*\\n\\nğŸ“š **HR. Ahmad**\\n\\nğŸŒŸ **Hadits tentang Ilmu:**\\n\\n*\"Ù…ÙÙ†Ù’ Ø³ÙÙ„ÙÙƒÙ Ø·ÙØ±ÙÙŠÙ‚Ù‹Ø§ ÙŠÙÙ„Ù’ØªÙÙ…ÙØ³Ù ÙÙÙŠÙ‡Ù Ø¹ÙÙ„Ù’Ù…Ù‹Ø§ Ø³ÙÙ‡ÙÙ‘Ù„Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù„ÙÙ‡Ù Ø¨ÙÙ‡Ù Ø·ÙØ±ÙÙŠÙ‚Ù‹Ø§ Ø¥ÙÙ„ÙÙ‰ Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù\"*\\n\\n*\"Barangsiapa menempuh jalan untuk mencari ilmu, maka Allah akan mudahkan baginya jalan menuju surga\"*\\n\\nğŸ“š **HR. Muslim**\\n\\nğŸŒŸ **Hadits tentang Sedekah:**\\n\\n*\"Ø§Ù„ØµÙÙ‘Ø¯ÙÙ‚ÙØ©Ù ØªÙØ·Ù’ÙÙØ¦Ù Ø§Ù„Ù’Ø®ÙØ·ÙÙŠØ¦ÙØ©Ù ÙƒÙÙ…ÙØ§ ÙŠÙØ·Ù’ÙÙØ¦Ù Ø§Ù„Ù’Ù…ÙØ§Ø¡Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù\"*\\n\\n*\"Sedekah dapat menghapus dosa sebagaimana air memadamkan api\"*\\n\\nğŸ“š **HR. Tirmidzi**`,\n\n  kajian_pengajian: () => {\n    const ustadz = data.masjid.ustadz;\n    return `ğŸ“š *JADWAL KAJIAN & PENGAJIAN*\\nğŸ“ ${data.masjid.info.nama}\\n\\nğŸ“– **KAJIAN RUTIN MINGGUAN**\\n\\nğŸŸ¢ **AHAD - Kajian Keluarga**\\nğŸ•˜ 09:00-11:00 WIB\\nğŸ‘¨â€ğŸ« ${ustadz[0].nama} & ${ustadz[2].nama}\\nğŸ“š Fiqh Keluarga & Parenting Islami\\nğŸ“ Aula Utama\\nğŸ‘¥ Keluarga (Free)\\n\\nğŸ”µ **SENIN - Tafsir Al-Quran**\\nğŸ•• 19:30-21:00 WIB\\nğŸ‘¨â€ğŸ« ${ustadz[0].nama}\\nğŸ“š Tafsir Surah Pilihan\\nğŸ“ Ruang Kajian\\nğŸ‘¥ Umum (Free)\\n\\nğŸŸ¡ **RABU - Fiqh Muamalah**\\nğŸ•— 20:00-21:30 WIB\\nğŸ‘¨â€ğŸ« ${ustadz[1].nama}\\nğŸ“š Ekonomi Islam Kontemporer\\nğŸ“ Ruang Kajian\\nğŸ‘¥ Umum (Free)\\n\\nğŸŸ£ **JUMAT - Kultum Jumatan**\\nğŸ• 12:30-13:00 WIB\\nğŸ‘¨â€ğŸ« Ustadz Tamu Mingguan\\nğŸ“š Tema Aktual Keislaman\\nğŸ“ Masjid Utama\\nğŸ‘¥ Jamaah Jumat\\n\\nğŸ”´ **SABTU - Kajian Wanita**\\nğŸ•˜ 09:00-11:00 WIB\\nğŸ‘©â€ğŸ« ${ustadz[2].nama}\\nğŸ“š Fiqh Wanita & Keluarga\\nğŸ“ Ruang Wanita\\nğŸ‘¥ Khusus Wanita\\n\\nğŸ“‹ **PENDAFTARAN KELAS KHUSUS**\\n\\nğŸ“ **Tahfidz Al-Quran**\\nğŸ“… Senin-Kamis 16:00-18:00\\nğŸ‘¥ Dewasa & Anak (10+ tahun)\\nğŸ’° Rp 200.000/bulan\\nğŸ¯ Target: 1 Juz/6 bulan\\n\\nğŸ“– **TPQ (Taman Pendidikan Quran)**\\nğŸ“… Selasa-Jumat 15:00-17:00\\nğŸ‘¥ Anak usia 4-12 tahun\\nğŸ’° Rp 150.000/bulan\\nğŸ“š Iqro + Juz Amma\\n\\nğŸ›ï¸ **Kelas Bahasa Arab**\\nğŸ“… Sabtu 08:00-10:00\\nğŸ‘¥ Remaja & Dewasa\\nğŸ’° Rp 300.000/bulan\\nğŸ“– Nahwu, Sharaf, Conversation\\n\\nğŸ“ **Pendaftaran:**\\nğŸ“± Admin: ${data.masjid.info.whatsapp}\\nğŸ“§ Email: ${data.masjid.info.email}\\nğŸŒ Website: ${data.masjid.info.website}`;\n  },\n\n  tpq_tahfidz: () => `ğŸ“š *PENDIDIKAN QURAN UNTUK ANAK*\\nğŸ“ ${data.masjid.info.nama}\\n\\nğŸ‘¶ **TPQ (Taman Pendidikan Quran)**\\n\\nğŸ“… **Jadwal:**\\nSelasa-Jumat: 15:00-17:00 WIB\\nSabtu: 08:00-10:00 WIB\\n\\nğŸ‘¥ **Usia:** 4-12 tahun\\nğŸ’° **Biaya:** Rp 150.000/bulan\\n\\nğŸ“– **Kurikulum:**\\nâ€¢ Iqro 1-6\\nâ€¢ Juz Amma (Surah pendek)\\nâ€¢ Hadits pilihan anak\\nâ€¢ Doa harian\\nâ€¢ Akhlak & adab Islam\\n\\nğŸ“ **TAHFIDZ AL-QURAN**\\n\\nğŸ“… **Jadwal:**\\nSenin-Kamis: 16:00-18:00 WIB\\nSabtu: 08:00-11:00 WIB\\n\\nğŸ‘¥ **Usia:** 10+ tahun (Dewasa welcome)\\nğŸ’° **Biaya:** Rp 200.000/bulan\\n\\nğŸ¯ **Target:**\\nâ€¢ 1 Juz dalam 6 bulan\\nâ€¢ Metode talaqqi (setoran langsung)\\nâ€¢ Muraja'ah (pengulangan) rutin\\nâ€¢ Tahsin (perbaikan bacaan)\\n\\nğŸ‘¨â€ğŸ« **Pengajar Berpengalaman:**\\nâ€¢ Hafidz 30 juz\\nâ€¢ Bersanad dari Madinah\\nâ€¢ Metode pembelajaran modern\\n\\nğŸ† **Prestasi Alumni:**\\nğŸ“œ 50+ Hafidz/Hafidzah\\nğŸ“ Banyak melanjutkan ke pesantren\\nğŸ… Juara MTQ tingkat Jakarta\\n\\nğŸ“ **Daftar Sekarang:**\\nğŸ“± ${data.masjid.info.whatsapp}\\nğŸ“§ pendidikan@masjidalukhlas.id`,\n\n  konsultasi_syariah: () => {\n    const ustadz = data.masjid.ustadz;\n    return `ğŸ¤² *KONSULTASI SYARIAH & BIMBINGAN ROHANI*\\nğŸ“ ${data.masjid.info.nama}\\n\\nğŸ‘¨â€ğŸ« **TIM USTADZ KONSULTAN BERPENGALAMAN**\\n\\nğŸŸ¢ **${ustadz[0].nama}**\\nğŸ“ ${ustadz[0].pendidikan}\\nâ­ Pengalaman: ${ustadz[0].pengalaman}\\n\\nğŸ“š **Spesialisasi:**\\n${ustadz[0].spesialisasi.map(s => `â€¢ ${s}`).join('\\n')}\\n\\nâ° **Jadwal:** ${ustadz[0].jadwal}\\nğŸ“± **Kontak:** ${ustadz[0].kontak}\\nğŸ“§ **Email:** ${ustadz[0].email}\\n\\nğŸ”µ **${ustadz[1].nama}**\\nğŸ“ ${ustadz[1].pendidikan}\\nâ­ Pengalaman: ${ustadz[1].pengalaman}\\n\\nğŸ“š **Spesialisasi:**\\n${ustadz[1].spesialisasi.map(s => `â€¢ ${s}`).join('\\n')}\\n\\nâ° **Jadwal:** ${ustadz[1].jadwal}\\nğŸ“± **Kontak:** ${ustadz[1].kontak}\\nğŸ“§ **Email:** ${ustadz[1].email}\\n\\nğŸŸ¡ **${ustadz[2].nama}**\\nğŸ“ ${ustadz[2].pendidikan}\\nâ­ Pengalaman: ${ustadz[2].pengalaman}\\n\\nğŸ“š **Spesialisasi:**\\n${ustadz[2].spesialisasi.map(s => `â€¢ ${s}`).join('\\n')}\\n\\nâ° **Jadwal:** ${ustadz[2].jadwal}\\nğŸ“± **Kontak:** ${ustadz[2].kontak}\\nğŸ“§ **Email:** ${ustadz[2].email}\\n\\nğŸ“‹ **KATEGORI KONSULTASI**\\n\\nğŸ’’ **Pernikahan & Keluarga**\\nğŸ‘¶ **Parenting Islami**\\nğŸ’° **Ekonomi & Keuangan Syariah**\\nğŸ¢ **Pekerjaan & Karir**\\nğŸ©º **Kesehatan & Medis**\\nğŸ“ **Pendidikan & Sosial**\\n\\nğŸ“± **METODE KONSULTASI:**\\nğŸ¢ Tatap muka di masjid\\nğŸ“ Telepon/WhatsApp\\nğŸ’» Video call (Zoom/Meet)\\nğŸ“§ Email konsultasi\\n\\nğŸ’° **GRATIS** (Donasi sukarela)\\nâ±ï¸ **Response time:** < 2 jam\\n\\nğŸ“ **Booking:** ${data.masjid.info.whatsapp}`;\n  },\n\n  donasi_infaq: () => {\n    const banks = data.masjid.rekening.banks;\n    const ewallet = data.masjid.rekening.ewallet;\n    return `ğŸ’° *DONASI & ZAKAT ${data.masjid.info.nama}*\\n\\nğŸ¦ **REKENING BANK RESMI**\\n\\nğŸ’³ **BCA**\\nğŸ”¢ ${banks.bca.no}\\nğŸ‘¤ a.n. ${banks.bca.name}\\n\\nğŸ’³ **Mandiri**\\nğŸ”¢ ${banks.mandiri.no}\\nğŸ‘¤ a.n. ${banks.mandiri.name}\\n\\nğŸ’³ **BRI**\\nğŸ”¢ ${banks.bri.no}\\nğŸ‘¤ a.n. ${banks.bri.name}\\n\\nğŸ“± **E-WALLET & DIGITAL PAYMENT**\\n\\nğŸ’° **DANA:** ${ewallet.dana}\\nğŸ’° **GoPay:** ${ewallet.gopay}\\nğŸ’° **OVO:** ${ewallet.ovo}\\nğŸ’° **ShopeePay:** ${ewallet.shopeepay}\\n\\nğŸ“± **QRIS Universal:**\\nğŸ”— ${data.masjid.rekening.qris}\\n\\nğŸ’ **KATEGORI DONASI**\\n\\nğŸ•Œ **Operasional Masjid (Rp 50jt/bulan)**\\nâ€¢ Listrik, air, kebersihan\\nâ€¢ Gaji imam & staff\\nâ€¢ Maintenance fasilitas\\n\\nğŸ“š **Pendidikan Islam (Rp 30jt/bulan)**\\nâ€¢ Gaji ustadz/ustadzah\\nâ€¢ Buku & materi pembelajaran\\nâ€¢ Beasiswa anak kurang mampu\\n\\nğŸ¤ **Program Sosial (Rp 25jt/bulan)**\\nâ€¢ Bantuan fakir miskin\\nâ€¢ Santunan anak yatim\\nâ€¢ Ambulans & kesehatan\\n\\nğŸ—ï¸ **Pembangunan (Rp 100jt/tahun)**\\nâ€¢ Renovasi & perluasan\\nâ€¢ Fasilitas baru\\nâ€¢ Teknologi masjid\\n\\nğŸ“Š **KALKULATOR ZAKAT**\\nğŸ’° **Zakat Mal:** 2.5% dari Rp 81.000.000+\\nğŸŒ¾ **Zakat Profesi:** 2.5% dari gaji Rp 7.000.000+\\n\\nğŸ“‹ **LAPORAN TRANSPARAN**\\nğŸ“Š Dashboard: transparansi.masjidalukhlas.id\\nğŸ“± Update mingguan via WhatsApp\\nğŸ“§ Laporan bulanan via email\\n\\nğŸ“ **Konfirmasi Donasi:**\\nğŸ“± ${data.masjid.info.whatsapp}\\nğŸ“§ donasi@masjidalukhlas.id\\n\\nğŸ¤² *Jazakumullahu khairan kathiran*`;\n  },\n\n  layanan_jenazah: () => `ğŸ•Šï¸ *LAYANAN JENAZAH 24/7*\\nğŸ“ ${data.masjid.info.nama}\\n\\nØ¥ÙÙ†ÙÙ‘Ø§ Ù„ÙÙ„ÙÙ‘Ù‡Ù ÙˆÙØ¥ÙÙ†ÙÙ‘Ø§ Ø¥ÙÙ„ÙÙŠÙ’Ù‡Ù Ø±ÙØ§Ø¬ÙØ¹ÙÙˆÙ†Ù\\n*Innalillahi wa inna ilaihi raji'un*\\n\\nğŸ“‹ **TIM JENAZAH SIAGA 24 JAM**\\n\\nğŸ”¹ **Koordinator Jenazah**\\nğŸ‘¤ H. Bambang Sutrisno\\nğŸ“± +62-815-1234-5678\\n\\nğŸ”¹ **Tim Pemandian (Pria)**\\nğŸ‘¤ Ustadz Ahmad Fauzi\\nğŸ“± +62-816-1111-2222\\n\\nğŸ”¹ **Tim Pemandian (Wanita)**\\nğŸ‘¤ Ibu Hj. Siti Aminah\\nğŸ“± +62-816-3333-4444\\n\\nğŸ”¹ **Tim Kafan & Perlengkapan**\\nğŸ‘¤ Bpk. Muhammad Yusuf\\nğŸ“± +62-817-5555-6666\\n\\nğŸ“¦ **LAYANAN LENGKAP TERSEDIA:**\\n\\nâœ… **Pemandian Jenazah**\\nâ€¢ Sesuai sunnah Rasulullah\\nâ€¢ Terpisah pria & wanita\\nâ€¢ Peralatan steril & lengkap\\n\\nâœ… **Kafan Berkualitas**\\nâ€¢ Kain putih berkualitas tinggi\\nâ€¢ Sesuai syariat Islam\\nâ€¢ Ukuran dewasa & anak\\n\\nâœ… **Ambulans & Transportasi**\\nâ€¢ 2 unit ambulans siap 24/7\\nâ€¢ Sopir berpengalaman\\nâ€¢ Gratis dalam kota Jakarta\\n\\nâœ… **Prosesi Pemakaman**\\nâ€¢ Shalat jenazah berjamaah\\nâ€¢ Pengurusan surat-surat\\nâ€¢ Pendampingan ke TPU\\n\\nâœ… **Tahlilan & Doa**\\nâ€¢ Hari ke-3, 7, 40, 100\\nâ€¢ Tim qori berpengalaman\\nâ€¢ Konsumsi sederhana\\n\\nğŸ’° **DONASI SUKARELA**\\nğŸ¦ BCA: ${data.masjid.rekening.banks.bca.no}\\nğŸ“± DANA: ${data.masjid.rekening.ewallet.dana}\\na.n. ${data.masjid.info.nama}\\n\\nğŸš¨ **HOTLINE 24 JAM:**\\nğŸ“± ${data.masjid.info.whatsapp}\\nğŸ“ (021) 1234-5678\\n\\nğŸ¤² *Semoga amal ibadah almarhum/almarhumah diterima Allah SWT*`,\n\n  ambulans_emergency: () => `ğŸš‘ *LAYANAN AMBULANS DARURAT*\\nğŸ“ ${data.masjid.info.nama}\\n\\nğŸ†˜ **AMBULANS SIAGA 24/7**\\n\\nğŸš‘ **Unit 1 - Ambulans Utama**\\nğŸ“± Call: 0812-AMBULANS-1\\nğŸ‘¨â€âš•ï¸ Driver + Paramedis\\nğŸ¥ Dilengkapi oksigen & P3K\\n\\nğŸš‘ **Unit 2 - Ambulans Cadangan**\\nğŸ“± Call: 0812-AMBULANS-2\\nğŸ‘¨â€âš•ï¸ Driver berpengalaman\\nğŸ¥ Peralatan medis dasar\\n\\nâš¡ **RESPONSE TIME:** < 15 menit\\nğŸ¯ **COVERAGE AREA:** Jakarta & sekitarnya\\nğŸ’° **GRATIS** untuk jamaah masjid\\n\\nğŸ¥ **RUMAH SAKIT REKANAN:**\\nâ€¢ RSUD Fatmawati\\nâ€¢ RS Siloam Kebayoran\\nâ€¢ RS Medistra\\nâ€¢ RS Pondok Indah\\nâ€¢ RS Jakarta Heart Center\\n\\nğŸ“‹ **PROSEDUR EMERGENCY:**\\n1. Telepon hotline ambulans\\n2. Berikan alamat lengkap\\n3. Jelaskan kondisi pasien\\n4. Tunggu di lokasi yang mudah diakses\\n5. Siapkan kartu identitas\\n\\nğŸš¨ **KONDISI YANG DILAYANI:**\\nâ€¢ Serangan jantung\\nâ€¢ Stroke\\nâ€¢ Kecelakaan\\nâ€¢ Sesak napas\\nâ€¢ Pendarahan\\nâ€¢ Pingsan\\nâ€¢ Persalinan darurat\\n\\nğŸ“± **HOTLINE DARURAT:**\\nğŸš‘ ${data.masjid.info.whatsapp}\\nğŸ“ (021) 1234-5678\\n\\nâš ï¸ **Untuk kondisi kritis:** Langsung call 118/119\\n\\nğŸ¤² Semoga Allah berikan kesembuhan`,\n\n  klinik_kesehatan: () => `ğŸ¥ *KLINIK KESEHATAN MASJID*\\nğŸ“ ${data.masjid.info.nama}\\n\\nğŸ‘©â€âš•ï¸ **PELAYANAN MEDIS**\\n\\nğŸ• **Jam Operasional:**\\nSenin-Jumat: 08:00-15:00 WIB\\nSabtu: 08:00-12:00 WIB\\nMinggu: TUTUP (Emergency tetap)\\n\\nğŸ‘¨â€âš•ï¸ **TIM MEDIS:**\\n\\nğŸ©º **dr. Ahmad Hidayat, Sp.PD**\\nâ° Senin, Rabu, Jumat: 08:00-12:00\\nğŸ“š Spesialis Penyakit Dalam\\n\\nğŸ©º **dr. Siti Nurhaliza, Sp.A**\\nâ° Selasa, Kamis: 08:00-12:00\\nğŸ“š Spesialis Anak\\n\\nğŸ©º **dr. Muhammad Ridwan**\\nâ° Senin-Jumat: 13:00-15:00\\nğŸ“š Dokter Umum\\n\\nğŸ’Š **LAYANAN TERSEDIA:**\\n\\nâœ… **Pemeriksaan Umum**\\nâ€¢ Konsultasi kesehatan\\nâ€¢ Cek tekanan darah\\nâ€¢ Cek gula darah\\nâ€¢ Cek kolesterol\\n\\nâœ… **Pelayanan Anak**\\nâ€¢ Imunisasi lengkap\\nâ€¢ Tumbuh kembang\\nâ€¢ Konsultasi gizi\\n\\nâœ… **Kesehatan Wanita**\\nâ€¢ Konsultasi kehamilan\\nâ€¢ KB alami\\nâ€¢ Pemeriksaan ibu hamil\\n\\nâœ… **Pengobatan Herbal**\\nâ€¢ Thibbun Nabawi\\nâ€¢ Bekam/Hijama\\nâ€¢ Terapi herbal\\n\\nğŸ’° **TARIF TERJANGKAU:**\\nğŸ‘¥ Jamaah masjid: GRATIS\\nğŸ‘¥ Umum: Rp 25.000\\nğŸ’Š Obat: Harga modal\\n\\nğŸ“ **Reservasi & Info:**\\nğŸ“± ${data.masjid.info.whatsapp}\\nğŸ“§ klinik@masjidalukhlas.id`,\n\n  cuaca_jakarta: () => `ğŸŒ¤ï¸ *CUACA JAKARTA HARI INI*\\nğŸ“… ${moment().format('dddd, DD MMMM YYYY')}\\n\\nâ˜€ï¸ **Prakiraan Cuaca:**\\nğŸŒ¡ï¸ Suhu: 28-32Â°C\\nğŸ’§ Kelembaban: 70-85%\\nğŸŒ¬ï¸ Angin: 5-10 km/h\\nâ˜ï¸ Kondisi: Berawan sebagian\\n\\nğŸŒ§ï¸ **Prediksi Hujan:**\\nğŸ• 13:00-15:00: 60% kemungkinan\\nğŸ•• 17:00-19:00: 40% kemungkinan\\nğŸŒ™ Malam: Cerah berawan\\n\\nğŸ•Œ **Tips untuk Jamaah:**\\nâ€¢ Bawa payung untuk shalat Dzuhur\\nâ€¢ Gunakan alas kaki yang nyaman\\nâ€¢ Minum air yang cukup\\nâ€¢ Wudhu dengan air sejuk\\n\\nâ° **Update:** ${moment().format('HH:mm')} WIB\\nğŸ“¡ **Sumber:** BMKG & WeatherAPI\\n\\nğŸ’¡ Ketik \"jadwal shalat\" untuk waktu shalat hari ini`,\n\n  live_streaming: () => `ğŸ“º *LIVE STREAMING MASJID*\\nğŸ“ ${data.masjid.info.nama}\\n\\nğŸ”´ **LIVE STREAMING TERSEDIA:**\\n\\nğŸ“± **Platform Streaming:**\\nâ€¢ YouTube: Masjid Al-Ikhlas TV\\nâ€¢ Facebook: @MasjidAlIkhlas\\nâ€¢ Instagram: @masjidalukhlas\\nâ€¢ Website: ${data.masjid.info.website}/live\\n\\nğŸ•Œ **JADWAL STREAMING RUTIN:**\\n\\nğŸŒ… **Shalat Subuh**\\nğŸ• 04:30-05:30 WIB\\nğŸ“º Live di semua platform\\n\\nâ˜€ï¸ **Shalat Dzuhur**\\nğŸ• 12:15-12:45 WIB\\nğŸ“º YouTube & Facebook\\n\\nğŸŒ™ **Shalat Magrib**\\nğŸ• 18:45-19:15 WIB\\nğŸ“º Live di semua platform\\n\\nğŸ•Œ **Shalat Jumat**\\nğŸ• 11:30-13:00 WIB\\nğŸ“º Full coverage + khutbah\\nğŸ“± Interactive chat enabled\\n\\nğŸ“š **KAJIAN LIVE:**\\nğŸ•— Senin malam: Tafsir Al-Quran\\nğŸ•— Rabu malam: Fiqh Muamalah\\nğŸ•— Sabtu pagi: Kajian Wanita\\n\\nğŸ¥ **FITUR STREAMING:**\\nâœ… HD Quality (1080p)\\nâœ… Audio jernih\\nâœ… Multiple camera angles\\nâœ… Interactive chat\\nâœ… Recording tersedia\\n\\nğŸ“Š **STATISTIK:**\\nğŸ‘¥ 1000+ viewers rata-rata\\nğŸ“ˆ Growing community\\nğŸ’¬ Active chat participation\\n\\nğŸ”” **NOTIFIKASI:**\\nSubscribe & aktifkan bell notification\\nuntuk update streaming terbaru\\n\\nğŸ“± **Info Teknis:**\\nğŸ“§ streaming@masjidalukhlas.id\\nğŸ“± ${data.masjid.info.whatsapp}`,\n\n  info_masjid: () => {\n    const masjid = data.masjid;\n    return `ğŸ•Œ *${masjid.info.nama.toUpperCase()}*\\n*Pusat Ibadah & Dakwah Umat*\\n\\nğŸ“ **INFORMASI LENGKAP**\\n\\nğŸ  **Alamat:**\\n${masjid.info.alamat}\\n\\nğŸ“Š **Profil Masjid:**\\nğŸ“… Berdiri: ${masjid.info.established}\\nğŸ‘¥ Kapasitas: ${masjid.info.capacity} jamaah\\nğŸ“ Koordinat: ${masjid.info.coordinates.lat}, ${masjid.info.coordinates.lng}\\n\\nğŸ“ **Kontak Resmi:**\\nğŸ“± WhatsApp: ${masjid.info.whatsapp}\\nğŸ“§ Email: ${masjid.info.email}\\nğŸŒ Website: ${masjid.info.website}\\n\\nğŸ¢ **FASILITAS UTAMA:**\\n\\nğŸ•Œ **Masjid Utama:**\\n${masjid.fasilitas.utama.map(f => `â€¢ ${f}`).join('\\n')}\\n\\nğŸš¿ **Tempat Wudhu:**\\n${masjid.fasilitas.wudhu.map(f => `â€¢ ${f}`).join('\\n')}\\n\\nğŸš» **Toilet & Sanitasi:**\\n${masjid.fasilitas.toilet.map(f => `â€¢ ${f}`).join('\\n')}\\n\\nğŸ…¿ï¸ **Area Parkir:**\\n${masjid.fasilitas.parkir.map(f => `â€¢ ${f}`).join('\\n')}\\n\\nğŸ“š **Pendidikan:**\\n${masjid.fasilitas.pendidikan.map(f => `â€¢ ${f}`).join('\\n')}\\n\\nğŸ¥ **Kesehatan:**\\n${masjid.fasilitas.kesehatan.map(f => `â€¢ ${f}`).join('\\n')}\\n\\nğŸª **Fasilitas Lainnya:**\\n${masjid.fasilitas.lainnya.map(f => `â€¢ ${f}`).join('\\n')}\\n\\nğŸ• **Jam Operasional:**\\nBuka 24 jam untuk ibadah\\nPelayanan admin: 08:00-16:00 WIB\\n\\nğŸ¯ **Visi:**\\nMenjadi pusat ibadah dan dakwah terdepan\\n\\nğŸ“‹ **Misi:**\\nâ€¢ Melayani umat dengan excellence\\nâ€¢ Pendidikan Islam berkualitas\\nâ€¢ Pemberdayaan ekonomi syariah\\nâ€¢ Kepedulian sosial berkelanjutan`;\n  },\n\n  salam_greeting: () => {\n    const timeBasedGreeting = () => {\n      const hour = moment().hour();\n      if (hour < 6) return 'dini hari';\n      if (hour < 11) return 'pagi';\n      if (hour < 15) return 'siang';\n      if (hour < 18) return 'sore';\n      return 'malam';\n    };\n    \n    return `ÙˆÙØ¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù Ø§Ù„Ø³ÙÙ‘Ù„ÙØ§Ù…Ù ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¨ÙØ±ÙÙƒÙØ§ØªÙÙ‡Ù\\n\\n*Wa'alaikumussalam warahmatullahi wabarakatuh*\\n\\nSelamat ${timeBasedGreeting()} dan selamat datang di\\nğŸ•Œ **${data.masjid.info.nama}**\\n\\nğŸ“± **MENU LAYANAN LENGKAP:**\\n\\nğŸ•Œ **IBADAH & SPIRITUAL**\\n1ï¸âƒ£ Jadwal Shalat & Reminder\\n2ï¸âƒ£ Arah Kiblat & Kompas\\n3ï¸âƒ£ Doa & Dzikir Harian\\n4ï¸âƒ£ Ayat Al-Quran Pilihan\\n5ï¸âƒ£ Hadits Rasulullah\\n\\nğŸ“š **PENDIDIKAN ISLAM**\\n6ï¸âƒ£ Kajian & Pengajian\\n7ï¸âƒ£ TPQ & Tahfidz Quran\\n8ï¸âƒ£ Kelas Bahasa Arab\\n9ï¸âƒ£ Konsultasi Syariah\\n\\nğŸ¤ **LAYANAN SOSIAL**\\nğŸ”Ÿ Donasi & Zakat\\n1ï¸âƒ£1ï¸âƒ£ Program Sosial\\n1ï¸âƒ£2ï¸âƒ£ Layanan Jenazah\\n1ï¸âƒ£3ï¸âƒ£ Ambulans Emergency\\n1ï¸âƒ£4ï¸âƒ£ Klinik Kesehatan\\n\\n â„¹ï¸ **INFORMASI**\\n1ï¸âƒ£5ï¸âƒ£ Info Masjid Lengkap\\n1ï¸âƒ£6ï¸âƒ£ Cuaca Jakarta\\n1ï¸âƒ£7ï¸âƒ£ Live Streaming\\n1ï¸âƒ£8ï¸âƒ£ Chat AI Islami\\n\\nğŸ’¬ **Cara Penggunaan:**\\nâ€¢ Ketik nama layanan (contoh: \"jadwal shalat\")\\nâ€¢ Atau langsung chat untuk diskusi\\nâ€¢ Gunakan kata kunci yang jelas\\n\\nğŸ¤– **AI Assistant siap membantu 24/7!**\\n\\nğŸ• Saat ini: ${moment().format('HH:mm')} WIB\\nğŸ“… ${moment().format('dddd, DD MMMM YYYY')}`;\n  }\n};\n\n// Get response based on intent\nconst template = serviceTemplates[data.intent];\nif (!template) {\n  return [{\n    json: {\n      ...data,\n      response: `âŒ Service template untuk \"${data.intent}\" belum tersedia. Silakan chat dengan AI atau pilih menu lainnya.`,\n      response_type: 'TEMPLATE_NOT_FOUND'\n    }\n  }];\n}\n\nconst response = template();\n\nreturn [{\n  json: {\n    ...data,\n    response: response,\n    response_type: 'SERVICE_TEMPLATE'\n  }\n}];"
      },
      "id": "7",
      "name": "ğŸ¯ Service Handler",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1200, 600]
    },
    {
      "parameters": {
        "url": "https://api.fonnte.com/send",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "YOUR_WHATSAPP_API_KEY"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "target",
              "value": "={{ $json.phone }}"
            },
            {
              "name": "message",
              "value": "={{ $json.response }}"
            },
            {
              "name": "countryCode",
              "value": "62"
            }
          ]
        }
      },
      "id": "8",
      "name": "ğŸ“¤ WhatsApp Sender",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1450, 500]
    },
    {
      "parameters": {
        "url": "={{ $json.config.apis.supabase_url }}/rest/v1/chat_analytics",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $json.config.apis.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "Bearer {{ $json.config.apis.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=minimal"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "user_phone",
              "value": "={{ $json.phone }}"
            },
            {
              "name": "intent",
              "value": "={{ $json.intent }}"
            },
            {
              "name": "confidence",
              "value": "={{ $json.confidence || 0 }}"
            },
            {
              "name": "response_type",
              "value": "={{ $json.response_type }}"
            },
            {
              "name": "message_type",
              "value": "={{ $json.messageType }}"
            },
            {
              "name": "processing_time",
              "value": "={{ $json.processing_time }}"
            },
            {
              "name": "timestamp",
              "value": "={{ $json.timestamp }}"
            },
            {
              "name": "day_name",
              "value": "={{ $json.day_name }}"
            },
            {
              "name": "is_friday",
              "value": "={{ $json.is_friday }}"
            },
            {
              "name": "is_prayer_time",
              "value": "={{ $json.is_prayer_time }}"
            },
            {
              "name": "ai_model",
              "value": "={{ $json.ai_model || 'none' }}"
            },
            {
              "name": "ai_tokens",
              "value": "={{ $json.ai_tokens || 0 }}"
            }
          ]
        }
      },
      "id": "9",
      "name": "ğŸ“Š Analytics Logger",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1450, 600]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ {\n  \"success\": true,\n  \"message\": \"Advanced workflow completed successfully\",\n  \"data\": {\n    \"phone\": $json.phone,\n    \"intent\": $json.intent,\n    \"confidence\": $json.confidence || 0,\n    \"response_type\": $json.response_type,\n    \"processing_time\": $json.processing_time + \"ms\",\n    \"timestamp\": $json.timestamp,\n    \"ai_powered\": $json.ai_model ? true : false\n  },\n  \"features\": {\n    \"smart_classification\": true,\n    \"context_aware\": true,\n    \"multi_provider_whatsapp\": true,\n    \"rich_services\": true,\n    \"ai_chat\": true,\n    \"analytics\": true\n  }\n} }}"
      },
      "id": "10",
      "name": "âœ… Success Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1700, 550]
    }
  ],
  "connections": {
    "ğŸ“± WhatsApp Gateway": {
      "main": [
        [
          {
            "node": "ğŸ§  Smart Classifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ§  Smart Classifier": {
      "main": [
        [
          {
            "node": "ğŸ¤– Need AI?",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ•Œ Prayer Service?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– Need AI?": {
      "main": [
        [
          {
            "node": "ğŸ¤– AI Chat Engine",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "ğŸ•Œ Prayer Service?": {
      "main": [
        [
          {
            "node": "ğŸ•Œ Prayer Generator",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ¯ Service Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– AI Chat Engine": {
      "main": [
        [
          {
            "node": "ğŸ“¤ WhatsApp Sender",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“Š Analytics Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ•Œ Prayer Generator": {
      "main": [
        [
          {
            "node": "ğŸ“¤ WhatsApp Sender",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“Š Analytics Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ Service Handler": {
      "main": [
        [
          {
            "node": "ğŸ“¤ WhatsApp Sender",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“Š Analytics Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¤ WhatsApp Sender": {
      "main": [
        [
          {
            "node": "âœ… Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Analytics Logger": {
      "main": [
        [
          {
            "node": "âœ… Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3.0",
  "id": "masjid-ai-advanced-workflow",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "tags": [
    {
      "id": "advanced-features",
      "name": "Advanced Features"
    },
    {
      "id": "masjid-ai",
      "name": "Masjid AI"
    },
    {
      "id": "rich-services",
      "name": "Rich Services"
    },
    {
      "id": "smart-classification",
      "name": "Smart Classification"
    }
  ]
}