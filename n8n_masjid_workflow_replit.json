{
  "name": "Masjid AI Workflow - Replit Ready",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "webhook-masjid",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "1",
      "name": "ðŸ“± WhatsApp Gateway",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [200, 400]
    },
    {
      "parameters": {
        "functionCode": "// ðŸš€ SMART MESSAGE PROCESSOR FOR REPLIT\nconst moment = require('moment');\n\n// Configuration optimized for Replit\nconst CONFIG = {\n  apis: {\n    openrouter: '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',\n    supabase_url: 'https://bvaxxlmhrzocbrqiykoqul.supabase.co',\n    supabase_key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ2YXh4bG1ocnpvY2JycWl5a29xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4NjMxMDMsImV4cCI6MjA2OTQzOTEwM30.GjDhx8BUR7Y4FUS2PZalEeDhKVt_zQWGTEV_5nKKgrg'\n  },\n  ai_models: {\n    primary: 'moonshotai/kimi-k2:free',\n    fallback: 'google/gemma-7b-it:free'\n  }\n};\n\n// Masjid Information\nconst MASJID = {\n  info: {\n    nama: 'Masjid Al-Ikhlas',\n    alamat: 'Jl. Raya Masjid No. 123, Jakarta Selatan 12345',\n    whatsapp: '+62-812-3456-7890',\n    email: 'info@masjidalukhlas.id',\n    website: 'https://masjidalukhlas.id',\n    established: '15 Maret 1985',\n    capacity: 2000\n  },\n  \n  rekening: {\n    banks: {\n      bca: { no: '1234567890', name: 'Masjid Al-Ikhlas' },\n      mandiri: { no: '0987654321', name: 'Yayasan Masjid Al-Ikhlas' },\n      bri: { no: '5555666677778888', name: 'Takmir Masjid Al-Ikhlas' }\n    },\n    ewallet: {\n      dana: '081234567890',\n      gopay: '081234567890',\n      ovo: '081234567890',\n      shopeepay: '081234567890'\n    },\n    qris: 'https://replit.com/@yourname/qris-masjid.png'\n  },\n  \n  ustadz: [\n    {\n      nama: 'Ustadz Dr. Ahmad Dahlan, Lc., M.A',\n      spesialisasi: ['Fiqh Ibadah', 'Akhlaq & Tasawuf', 'Tafsir Al-Quran'],\n      jadwal: 'Senin-Kamis 19:00-21:00, Jumat 08:00-11:00',\n      kontak: '+62-813-1111-2222',\n      email: 'ahmad@masjidalukhlas.id'\n    },\n    {\n      nama: 'Ustadz Muhammad Ridwan, S.H.I., M.E.I',\n      spesialisasi: ['Ekonomi Syariah', 'Hukum Keluarga', 'Parenting Islami'],\n      jadwal: 'Selasa-Jumat 08:00-12:00, Sabtu 19:00-21:00',\n      kontak: '+62-813-3333-4444',\n      email: 'ridwan@masjidalukhlas.id'\n    },\n    {\n      nama: 'Ustadzah Dr. Aisyah Mahmud, Lc., M.Pd',\n      spesialisasi: ['Konsultasi Wanita', 'Pendidikan Anak', 'Psikologi Islam'],\n      jadwal: 'Rabu-Jumat 14:00-17:00 (Khusus wanita)',\n      kontak: '+62-814-4444-5555',\n      email: 'aisyah@masjidalukhlas.id'\n    }\n  ]\n};\n\n// Prayer Times Calculator\nfunction getPrayerTimes() {\n  const now = moment();\n  const times = {\n    fajr: '04:30',\n    sunrise: '05:45', \n    dhuhr: '12:15',\n    asr: '15:30',\n    maghrib: '18:45',\n    isha: '20:00'\n  };\n  \n  const currentHour = now.hour();\n  const currentMinute = now.minute();\n  const currentTime = currentHour * 60 + currentMinute;\n  \n  const prayerMinutes = {\n    fajr: 4 * 60 + 30,\n    dhuhr: 12 * 60 + 15,\n    asr: 15 * 60 + 30,\n    maghrib: 18 * 60 + 45,\n    isha: 20 * 60 + 0\n  };\n  \n  let nextPrayer = 'Subuh';\n  let nextTime = '04:30';\n  let countdown = '';\n  \n  for (const [prayer, minutes] of Object.entries(prayerMinutes)) {\n    if (currentTime < minutes) {\n      nextPrayer = prayer === 'fajr' ? 'Subuh' : \n                   prayer === 'dhuhr' ? 'Dzuhur' :\n                   prayer === 'asr' ? 'Ashar' :\n                   prayer === 'maghrib' ? 'Magrib' : 'Isya';\n      nextTime = times[prayer];\n      const remaining = minutes - currentTime;\n      const hours = Math.floor(remaining / 60);\n      const mins = remaining % 60;\n      countdown = `${hours}h ${mins}m`;\n      break;\n    }\n  }\n  \n  return { times, nextPrayer, nextTime, countdown };\n}\n\n// Intent Classification (Health services removed)\nfunction classifyIntent(message) {\n  const msg = message.toLowerCase();\n  const time = moment();\n  const hour = time.hour();\n  const day = time.day();\n  \n  const intents = {\n    // Spiritual Services\n    jadwal_shalat: {\n      keywords: ['jadwal shalat', 'waktu shalat', 'adzan', 'subuh', 'dzuhur', 'ashar', 'magrib', 'isya'],\n      score: hour >= 4 && hour <= 20 ? 10 : 7\n    },\n    kiblat_direction: {\n      keywords: ['kiblat', 'qibla', 'arah shalat', 'direction', 'compass'],\n      score: 8\n    },\n    doa_harian: {\n      keywords: ['doa', 'dzikir', 'wirid', 'tasbih', 'istighfar'],\n      score: 9\n    },\n    ayat_quran: {\n      keywords: ['ayat', 'quran', 'alquran', 'surah', 'verse'],\n      score: 9\n    },\n    hadits_nabi: {\n      keywords: ['hadits', 'hadith', 'sunnah', 'nabi', 'rasul'],\n      score: 8\n    },\n    \n    // Educational Services\n    kajian_pengajian: {\n      keywords: ['kajian', 'pengajian', 'ceramah', 'ustadz', 'belajar islam'],\n      score: day === 5 ? 10 : 7\n    },\n    tpq_tahfidz: {\n      keywords: ['tpq', 'tahfidz', 'mengaji', 'belajar quran', 'hafalan'],\n      score: 8\n    },\n    konsultasi_syariah: {\n      keywords: ['konsultasi', 'tanya ustadz', 'fatwa', 'hukum islam', 'syariah'],\n      score: 9\n    },\n    \n    // Community Services\n    donasi_infaq: {\n      keywords: ['donasi', 'infaq', 'sedekah', 'zakat', 'transfer', 'rekening'],\n      score: 8\n    },\n    program_sosial: {\n      keywords: ['sosial', 'bantuan', 'dhuafa', 'yatim', 'fakir miskin'],\n      score: 7\n    },\n    layanan_jenazah: {\n      keywords: ['jenazah', 'meninggal', 'kafan', 'pemakaman', 'tahlil'],\n      score: 10\n    },\n    \n    // Information Services\n    info_masjid: {\n      keywords: ['info', 'alamat', 'lokasi', 'kontak', 'fasilitas'],\n      score: 6\n    },\n    live_streaming: {\n      keywords: ['live', 'streaming', 'online', 'youtube', 'broadcast'],\n      score: hour >= 11 && hour <= 13 ? 8 : 6\n    },\n    \n    // AI Chat\n    ai_chat_islamic: {\n      keywords: ['tanya', 'bagaimana', 'kenapa', 'apa itu', 'jelaskan'],\n      score: 6\n    },\n    \n    // Greeting\n    salam_greeting: {\n      keywords: ['assalamualaikum', 'salam', 'halo', 'hai'],\n      score: 6\n    }\n  };\n  \n  let bestMatch = { intent: 'ai_chat_islamic', score: 0 };\n  \n  for (const [intent, config] of Object.entries(intents)) {\n    const matches = config.keywords.filter(keyword => msg.includes(keyword)).length;\n    const totalScore = matches * config.score;\n    \n    if (totalScore > bestMatch.score) {\n      bestMatch = { intent, score: totalScore, confidence: Math.min(totalScore / 10, 1) };\n    }\n  }\n  \n  return bestMatch;\n}\n\n// Message Parser for multi-provider\nfunction parseMessage(body) {\n  let phone, message, messageType, timestamp;\n  \n  if (body.entry && body.entry[0]?.changes?.[0]?.value?.messages) {\n    const msg = body.entry[0].changes[0].value.messages[0];\n    phone = msg.from;\n    messageType = msg.type;\n    message = msg.text?.body || `[${messageType}]`;\n    timestamp = msg.timestamp;\n  } else if (body.device && body.message) {\n    phone = body.device;\n    message = body.message;\n    messageType = body.message_type || 'text';\n    timestamp = body.date;\n  } else if (body.from && body.body) {\n    phone = body.from;\n    message = body.body;\n    messageType = body.type || 'text';\n    timestamp = body.timestamp;\n  } else if (body.phone && body.message) {\n    phone = body.phone;\n    message = body.message;\n    messageType = body.type || 'text';\n    timestamp = body.timestamp || Date.now();\n  }\n  \n  return { phone, message, messageType, timestamp };\n}\n\n// Clean phone number\nfunction cleanPhone(phone) {\n  if (!phone) return null;\n  phone = phone.replace(/[^0-9+]/g, '');\n  if (phone.startsWith('0')) phone = '+62' + phone.substring(1);\n  else if (phone.startsWith('62')) phone = '+' + phone;\n  else if (!phone.startsWith('+')) phone = '+62' + phone;\n  return phone;\n}\n\n// Main Processing\nconst startTime = Date.now();\nconst body = $input.all()[0].body;\n\nconst parsed = parseMessage(body);\nlet { phone, message, messageType, timestamp } = parsed;\n\nphone = cleanPhone(phone);\n\nif (!phone || !message) {\n  return [{\n    json: {\n      error: 'Invalid input',\n      hasError: true,\n      phone: phone || 'unknown',\n      message: message || 'empty'\n    }\n  }];\n}\n\nconst classification = classifyIntent(message);\nconst prayerData = getPrayerTimes();\n\nreturn [{\n  json: {\n    phone: phone,\n    message: message,\n    messageType: messageType,\n    timestamp: timestamp || new Date().toISOString(),\n    intent: classification.intent,\n    confidence: classification.confidence,\n    score: classification.score,\n    prayer_data: prayerData,\n    current_time: moment().format('HH:mm'),\n    current_date: moment().format('DD/MM/YYYY'),\n    day_name: moment().format('dddd'),\n    is_friday: moment().day() === 5,\n    processing_time: Date.now() - startTime,\n    hasError: false,\n    config: CONFIG,\n    masjid: MASJID\n  }\n}];"
      },
      "id": "2",
      "name": "ðŸ§  Smart Processor",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [450, 400]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.intent }}",
              "operation": "equal",
              "value2": "ai_chat_islamic"
            }
          ]
        }
      },
      "id": "3",
      "name": "ðŸ¤– Need AI?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [700, 400]
    },
    {
      "parameters": {
        "functionCode": "// ðŸ¤– AI CHAT ENGINE FOR REPLIT\nconst data = $input.all()[0].json;\n\nasync function generateAIResponse(message, context) {\n  const systemPrompt = `Anda adalah AI Assistant Masjid ${context.masjid.info.nama}, asisten cerdas untuk umat Islam.\n\nKARAKTER:\n- Berpengetahuan Islam (Al-Quran, Hadits, Fiqh)\n- Bijaksana, sabar, dan empati\n- Bahasa Indonesia mudah dipahami\n- Sopan dan santun\n- Jawaban praktis dan aplikatif\n\nKONTEKS:\n- Hari: ${context.day_name}\n- Waktu: ${context.current_time} WIB\n- Shalat selanjutnya: ${context.prayer_data.nextPrayer}\n\nMASJID INFO:\n- Nama: ${context.masjid.info.nama}\n- Alamat: ${context.masjid.info.alamat}\n- WhatsApp: ${context.masjid.info.whatsapp}\n\nUSTADZ:\n${context.masjid.ustadz.map(u => `- ${u.nama} (${u.spesialisasi.join(', ')})`).join('\\n')}\n\nPEDOMAN:\nâœ… Gunakan emoji relevan\nâœ… Jawaban terstruktur\nâœ… Sertakan dalil jika ada\nâœ… Rujuk ustadz untuk masalah kompleks\nâŒ Jangan berfatwa tanpa dasar\nâŒ Hindari politik/SARA`;\n\n  try {\n    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${context.config.apis.openrouter}`,\n        'Content-Type': 'application/json',\n        'HTTP-Referer': 'https://replit.com',\n        'X-Title': 'Masjid AI Replit'\n      },\n      body: JSON.stringify({\n        model: context.config.ai_models.primary,\n        messages: [\n          { role: 'system', content: systemPrompt },\n          { role: 'user', content: message }\n        ],\n        max_tokens: 1000,\n        temperature: 0.7\n      })\n    });\n    \n    if (response.ok) {\n      const result = await response.json();\n      let aiResponse = result.choices[0].message.content;\n      \n      if (!aiResponse.includes('ðŸ¤²') && !aiResponse.includes('Ø§Ù„Ø³Ù„Ø§Ù…')) {\n        aiResponse = 'ðŸ¤² ' + aiResponse;\n      }\n      \n      aiResponse += `\\n\\nðŸ’¡ **Menu Lainnya:**\\nâ€¢ \"jadwal shalat\" - Waktu shalat\\nâ€¢ \"donasi\" - Info rekening\\nâ€¢ \"kajian\" - Jadwal pengajian\\nâ€¢ \"info\" - Tentang masjid`;\n      \n      return {\n        response: aiResponse,\n        model_used: context.config.ai_models.primary,\n        tokens: result.usage?.total_tokens || 0,\n        status: 'success'\n      };\n    } else {\n      throw new Error('AI API Error');\n    }\n  } catch (error) {\n    return {\n      response: `ðŸ¤– Maaf, sistem AI sedang gangguan. \\n\\nUntuk bantuan:\\nðŸ‘¨â€ðŸ« ${context.masjid.ustadz[0].nama}: ${context.masjid.ustadz[0].kontak}\\nðŸ“± Admin: ${context.masjid.info.whatsapp}\\n\\nðŸ”„ Coba lagi nanti.`,\n      model_used: 'fallback',\n      tokens: 0,\n      status: 'error'\n    };\n  }\n}\n\nconst result = await generateAIResponse(data.message, data);\n\nreturn [{\n  json: {\n    ...data,\n    response: result.response,\n    ai_model: result.model_used,\n    ai_tokens: result.tokens,\n    ai_status: result.status,\n    response_type: 'AI_GENERATED'\n  }\n}];"
      },
      "id": "4",
      "name": "ðŸ¤– AI Engine",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [950, 300]
    },
    {
      "parameters": {
        "functionCode": "// ðŸ“‹ SERVICE TEMPLATES (Health services removed)\nconst data = $input.all()[0].json;\nconst moment = require('moment');\n\nconst serviceTemplates = {\n  jadwal_shalat: () => {\n    const prayerData = data.prayer_data;\n    const now = moment();\n    const times = prayerData.times;\n    \n    return `ðŸ•Œ *JADWAL SHALAT HARI INI*\\nðŸ“… ${now.format('dddd, DD MMMM YYYY')}\\nðŸ“ ${data.masjid.info.nama}\\n\\nðŸŒ… **Subuh:** ${times.fajr} WIB\\nðŸŒ„ **Terbit:** ${times.sunrise} WIB\\nâ˜€ï¸ **Dzuhur:** ${times.dhuhr} WIB\\nðŸŒ¤ï¸ **Ashar:** ${times.asr} WIB\\nðŸŒ… **Magrib:** ${times.maghrib} WIB\\nðŸŒ™ **Isya:** ${times.isha} WIB\\n\\nâ° **Shalat Selanjutnya:** ${prayerData.nextPrayer}\\nðŸ• **Waktu:** ${prayerData.nextTime} WIB\\n${prayerData.countdown ? `â³ **Countdown:** ${prayerData.countdown}\\n` : ''}\\nðŸ•‹ **Arah Kiblat:** 294Â° dari Utara\\nðŸ“ **Lokasi:** ${data.masjid.info.alamat}\\n\\nðŸ¤² *\"Aqiimu ash-shalata li dhikrii\"*\\n*\"Dirikanlah shalat untuk mengingat-Ku\"* (QS. Thaha: 14)`;\n  },\n  \n  kiblat_direction: () => `ðŸ§­ *ARAH KIBLAT*\\nðŸ“ ${data.masjid.info.nama}\\n\\nðŸ•‹ **Arah Kiblat:** 294Â° dari Utara (Barat Laut)\\nðŸ§­ Gunakan kompas atau aplikasi kiblat\\n\\nðŸ“± **Aplikasi Kiblat:**\\nâ€¢ Muslim Pro\\nâ€¢ Qibla Compass\\nâ€¢ Adzan Prayer Times\\n\\nðŸ•Œ **Tips:**\\n1. Gunakan kompas akurat\\n2. Hindari gangguan magnetik\\n3. Konfirmasi dengan aplikasi\\n4. Ikuti jamaah masjid\\n\\nðŸ¤² *\"Wa lillahi al-mashriqu wal-maghrib\"*\\n*\"Milik Allah-lah timur dan barat\"* (QS. Al-Baqarah: 115)`,\n  \n  doa_harian: () => `ðŸ¤² *DOA & DZIKIR HARIAN*\\n\\nðŸŒ… **DOA PAGI:**\\n*Ø£ÙŽØµÙ’Ø¨ÙŽØ­Ù’Ù†ÙŽØ§ ÙˆÙŽØ£ÙŽØµÙ’Ø¨ÙŽØ­ÙŽ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙŽÙ‘Ù‡Ù*\\n*Ashbahnaa wa ashbahal mulku lillaah*\\n*\"Kami memasuki pagi dan kerajaan milik Allah\"*\\n\\nðŸ“¿ **DZIKIR SETELAH SHALAT:**\\n*Ø³ÙØ¨Ù’Ø­ÙŽØ§Ù†ÙŽ Ø§Ù„Ù„ÙŽÙ‘Ù‡Ù* (33x)\\n*Ø§Ù„Ù’Ø­ÙŽÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙŽÙ‘Ù‡Ù* (33x)\\n*Ø§Ù„Ù„ÙŽÙ‘Ù‡Ù Ø£ÙŽÙƒÙ’Ø¨ÙŽØ±Ù* (34x)\\n\\nðŸŒ™ **DOA SORE:**\\n*Ø£ÙŽÙ…Ù’Ø³ÙŽÙŠÙ’Ù†ÙŽØ§ ÙˆÙŽØ£ÙŽÙ…Ù’Ø³ÙŽÙ‰ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙŽÙ‘Ù‡Ù*\\n*Amsaynaa wa amsal mulku lillaah*\\n\\nðŸ”„ **ISTIGHFAR:**\\n*Ø£ÙŽØ³Ù’ØªÙŽØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙŽ Ø§Ù„Ù’Ø¹ÙŽØ¸ÙÙŠÙ…ÙŽ* (100x)\\n\\nðŸ“– **Sumber:** HR. Bukhari & Muslim`,\n  \n  ayat_quran: () => `ðŸ“– *AYAT AL-QURAN PILIHAN*\\n\\nðŸŒŸ **QS. Al-Baqarah: 255 (Ayat Kursi)**\\n*Ø§Ù„Ù„ÙŽÙ‘Ù‡Ù Ù„ÙŽØ§ Ø¥ÙÙ„ÙŽÙ‡ÙŽ Ø¥ÙÙ„ÙŽÙ‘Ø§ Ù‡ÙÙˆÙŽ Ø§Ù„Ù’Ø­ÙŽÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙŽÙŠÙÙ‘ÙˆÙ…Ù*\\n*\"Allah, tidak ada Tuhan selain Dia Yang Hidup kekal...\"*\\n\\nðŸŒŸ **QS. Al-Ikhlas (1-4)**\\n*Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙŽ Ø§Ù„Ù„ÙŽÙ‘Ù‡Ù Ø£ÙŽØ­ÙŽØ¯ÙŒ*\\n*\"Katakanlah: Dia-lah Allah, Yang Maha Esa\"*\\n\\nðŸŒŸ **QS. Al-Falaq & An-Nas**\\nðŸ“¿ Mu'awwidzatain (Dua surah pelindung)`,\n  \n  hadits_nabi: () => `â˜ªï¸ *HADITS RASULULLAH SAW*\\n\\nðŸŒŸ **Hadits Akhlak:**\\n*\"Ø¥ÙÙ†ÙŽÙ‘Ù…ÙŽØ§ Ø¨ÙØ¹ÙØ«Ù’ØªÙ Ù„ÙØ£ÙØªÙŽÙ…ÙÙ‘Ù…ÙŽ ØµÙŽØ§Ù„ÙØ­ÙŽ Ø§Ù„Ù’Ø£ÙŽØ®Ù’Ù„ÙŽØ§Ù‚Ù\"*\\n*\"Aku diutus untuk menyempurnakan akhlak baik\"* (HR. Ahmad)\\n\\nðŸŒŸ **Hadits Ilmu:**\\n*\"Ù…ÙŽÙ†Ù’ Ø³ÙŽÙ„ÙŽÙƒÙŽ Ø·ÙŽØ±ÙÙŠÙ‚Ù‹Ø§ ÙŠÙŽÙ„Ù’ØªÙŽÙ…ÙØ³Ù ÙÙÙŠÙ‡Ù Ø¹ÙÙ„Ù’Ù…Ù‹Ø§ Ø³ÙŽÙ‡ÙŽÙ‘Ù„ÙŽ Ø§Ù„Ù„ÙŽÙ‘Ù‡Ù Ù„ÙŽÙ‡Ù Ø·ÙŽØ±ÙÙŠÙ‚Ù‹Ø§ Ø¥ÙÙ„ÙŽÙ‰ Ø§Ù„Ù’Ø¬ÙŽÙ†ÙŽÙ‘Ø©Ù\"*\\n*\"Barangsiapa menempuh jalan menuntut ilmu, Allah mudahkan jalan ke surga\"* (HR. Muslim)\\n\\nðŸŒŸ **Hadits Sedekah:**\\n*\"Ø§Ù„ØµÙŽÙ‘Ø¯ÙŽÙ‚ÙŽØ©Ù ØªÙØ·Ù’ÙÙØ¦Ù Ø§Ù„Ù’Ø®ÙŽØ·ÙÙŠØ¦ÙŽØ©ÙŽ ÙƒÙŽÙ…ÙŽØ§ ÙŠÙØ·Ù’ÙÙØ¦Ù Ø§Ù„Ù’Ù…ÙŽØ§Ø¡Ù Ø§Ù„Ù†ÙŽÙ‘Ø§Ø±ÙŽ\"*\\n*\"Sedekah menghapus dosa seperti air memadamkan api\"* (HR. Tirmidzi)`,\n  \n  kajian_pengajian: () => {\n    const ustadz = data.masjid.ustadz;\n    return `ðŸ“š *JADWAL KAJIAN & PENGAJIAN*\\nðŸ“ ${data.masjid.info.nama}\\n\\nðŸ“– **KAJIAN RUTIN MINGGUAN**\\n\\nðŸŸ¢ **AHAD - Kajian Keluarga**\\nðŸ•˜ 09:00-11:00 WIB\\nðŸ‘¨â€ðŸ« ${ustadz[0].nama}\\nðŸ“š Fiqh Keluarga & Parenting\\nðŸ‘¥ Keluarga (Free)\\n\\nðŸ”µ **SENIN - Tafsir Al-Quran**\\nðŸ•• 19:30-21:00 WIB\\nðŸ‘¨â€ðŸ« ${ustadz[0].nama}\\nðŸ“š Tafsir Surah Pilihan\\nðŸ‘¥ Umum (Free)\\n\\nðŸŸ¡ **RABU - Fiqh Muamalah**\\nðŸ•— 20:00-21:30 WIB\\nðŸ‘¨â€ðŸ« ${ustadz[1].nama}\\nðŸ“š Ekonomi Islam\\nðŸ‘¥ Umum (Free)\\n\\nðŸŸ£ **JUMAT - Kultum**\\nðŸ• 12:30-13:00 WIB\\nðŸ‘¨â€ðŸ« Ustadz Tamu\\nðŸ“š Tema Aktual\\nðŸ‘¥ Jamaah Jumat\\n\\nðŸ”´ **SABTU - Kajian Wanita**\\nðŸ•˜ 09:00-11:00 WIB\\nðŸ‘©â€ðŸ« ${ustadz[2].nama}\\nðŸ“š Fiqh Wanita\\nðŸ‘¥ Khusus Wanita\\n\\nðŸ“ž **Info:** ${data.masjid.info.whatsapp}`;\n  },\n  \n  tpq_tahfidz: () => `ðŸ“š *PENDIDIKAN QURAN*\\nðŸ“ ${data.masjid.info.nama}\\n\\nðŸ‘¶ **TPQ (Taman Pendidikan Quran)**\\nðŸ“… Selasa-Jumat: 15:00-17:00\\nðŸ‘¥ Usia: 4-12 tahun\\nðŸ’° Rp 150.000/bulan\\nðŸ“– Iqro 1-6, Juz Amma\\n\\nðŸŽ“ **TAHFIDZ AL-QURAN**\\nðŸ“… Senin-Kamis: 16:00-18:00\\nðŸ‘¥ Usia: 10+ tahun\\nðŸ’° Rp 200.000/bulan\\nðŸŽ¯ Target: 1 Juz/6 bulan\\n\\nðŸ‘¨â€ðŸ« **Pengajar:**\\nâ€¢ Hafidz 30 juz\\nâ€¢ Metode modern\\nâ€¢ Berpengalaman\\n\\nðŸ“ž **Daftar:** ${data.masjid.info.whatsapp}`,\n  \n  konsultasi_syariah: () => {\n    const ustadz = data.masjid.ustadz;\n    return `ðŸ¤² *KONSULTASI SYARIAH*\\nðŸ“ ${data.masjid.info.nama}\\n\\nðŸ‘¨â€ðŸ« **TIM USTADZ**\\n\\nðŸŸ¢ **${ustadz[0].nama}**\\nðŸ“š ${ustadz[0].spesialisasi.join(', ')}\\nâ° ${ustadz[0].jadwal}\\nðŸ“± ${ustadz[0].kontak}\\n\\nðŸ”µ **${ustadz[1].nama}**\\nðŸ“š ${ustadz[1].spesialisasi.join(', ')}\\nâ° ${ustadz[1].jadwal}\\nðŸ“± ${ustadz[1].kontak}\\n\\nðŸŸ¡ **${ustadz[2].nama}**\\nðŸ“š ${ustadz[2].spesialisasi.join(', ')}\\nâ° ${ustadz[2].jadwal}\\nðŸ“± ${ustadz[2].kontak}\\n\\nðŸ“‹ **KATEGORI:**\\nðŸ’’ Pernikahan & Keluarga\\nðŸ’° Ekonomi Syariah\\nðŸ‘¶ Parenting Islami\\nðŸŽ“ Pendidikan\\n\\nðŸ“± **METODE:**\\nðŸ¢ Tatap muka\\nðŸ“ž WhatsApp/Call\\nðŸ’» Video call\\nðŸ“§ Email\\n\\nðŸ’° **GRATIS** (Donasi sukarela)`;\n  },\n  \n  donasi_infaq: () => {\n    const banks = data.masjid.rekening.banks;\n    const ewallet = data.masjid.rekening.ewallet;\n    return `ðŸ’° *DONASI & ZAKAT*\\nðŸ“ ${data.masjid.info.nama}\\n\\nðŸ¦ **REKENING BANK**\\n\\nðŸ’³ **BCA:** ${banks.bca.no}\\na.n. ${banks.bca.name}\\n\\nðŸ’³ **Mandiri:** ${banks.mandiri.no}\\na.n. ${banks.mandiri.name}\\n\\nðŸ’³ **BRI:** ${banks.bri.no}\\na.n. ${banks.bri.name}\\n\\nðŸ“± **E-WALLET**\\nðŸ’° **DANA:** ${ewallet.dana}\\nðŸ’° **GoPay:** ${ewallet.gopay}\\nðŸ’° **OVO:** ${ewallet.ovo}\\nðŸ’° **ShopeePay:** ${ewallet.shopeepay}\\n\\nðŸ“± **QRIS:** ${data.masjid.rekening.qris}\\n\\nðŸ’Ž **KATEGORI DONASI**\\nðŸ•Œ Operasional (Rp 50jt/bulan)\\nðŸ“š Pendidikan (Rp 30jt/bulan)\\nðŸ¤ Sosial (Rp 25jt/bulan)\\nðŸ—ï¸ Pembangunan (Rp 100jt/tahun)\\n\\nðŸ“Š **ZAKAT CALCULATOR**\\nðŸ’° Zakat Mal: 2.5% dari Rp 81jt+\\nðŸŒ¾ Zakat Profesi: 2.5% dari gaji Rp 7jt+\\n\\nðŸ“ž **Konfirmasi:** ${data.masjid.info.whatsapp}\\nðŸ¤² *Jazakumullahu khairan*`;\n  },\n  \n  program_sosial: () => `ðŸ¤ *PROGRAM SOSIAL*\\nðŸ“ ${data.masjid.info.nama}\\n\\nðŸ‘¶ **SANTUNAN ANAK YATIM**\\nðŸ“… Setiap tanggal 10\\nðŸ‘¥ 250 anak\\nðŸ’° Rp 500.000/anak/bulan\\n\\nðŸ‘µ **BANTUAN LANSIA**\\nðŸ“… Setiap tanggal 15\\nðŸ‘¥ 150 lansia\\nðŸ’° Rp 300.000/orang/bulan\\n\\nðŸ½ï¸ **DAPUR UMUM**\\nðŸ“… Senin, Rabu, Jumat\\nðŸ• 11:00-13:00\\nðŸ‘¥ 300 porsi/hari\\n\\nðŸŽ“ **BEASISWA**\\nðŸ“š SD/MI: Rp 2jt/tahun\\nðŸ“š SMP/MTs: Rp 3jt/tahun\\nðŸ“š SMA/MA: Rp 4jt/tahun\\nðŸ“š Kuliah: Rp 10jt/tahun\\n\\nðŸ’¼ **UMKM COACHING**\\nðŸ“… Setiap bulan\\nðŸ‘¥ 30 peserta\\nðŸ’° Modal: Rp 2jt\\n\\nðŸ“ž **Info:** ${data.masjid.info.whatsapp}`,\n  \n  layanan_jenazah: () => `ðŸ•Šï¸ *LAYANAN JENAZAH 24/7*\\nðŸ“ ${data.masjid.info.nama}\\n\\nØ¥ÙÙ†ÙŽÙ‘Ø§ Ù„ÙÙ„ÙŽÙ‘Ù‡Ù ÙˆÙŽØ¥ÙÙ†ÙŽÙ‘Ø§ Ø¥ÙÙ„ÙŽÙŠÙ’Ù‡Ù Ø±ÙŽØ§Ø¬ÙØ¹ÙÙˆÙ†ÙŽ\\n\\nðŸ“‹ **TIM JENAZAH SIAGA**\\nðŸ”¹ Koordinator: H. Bambang (+62-815-1234-5678)\\nðŸ”¹ Tim Pemandian Pria: Ustadz Ahmad (+62-816-1111-2222)\\nðŸ”¹ Tim Pemandian Wanita: Hj. Siti (+62-816-3333-4444)\\n\\nðŸ“¦ **LAYANAN LENGKAP:**\\nâœ… Pemandian jenazah\\nâœ… Kafan berkualitas\\nâœ… Ambulans 2 unit\\nâœ… Prosesi pemakaman\\nâœ… Tahlilan 3,7,40,100 hari\\n\\nðŸ’° **DONASI SUKARELA**\\nðŸ¦ BCA: ${data.masjid.rekening.banks.bca.no}\\nðŸ“± DANA: ${data.masjid.rekening.ewallet.dana}\\n\\nðŸš¨ **HOTLINE 24 JAM:** ${data.masjid.info.whatsapp}\\nðŸ¤² *Semoga diterima Allah SWT*`,\n  \n  info_masjid: () => {\n    const masjid = data.masjid;\n    return `ðŸ•Œ *${masjid.info.nama.toUpperCase()}*\\n\\nðŸ“ **ALAMAT**\\n${masjid.info.alamat}\\n\\nðŸ“Š **PROFIL**\\nðŸ“… Berdiri: ${masjid.info.established}\\nðŸ‘¥ Kapasitas: ${masjid.info.capacity} jamaah\\n\\nðŸ“ž **KONTAK**\\nðŸ“± WhatsApp: ${masjid.info.whatsapp}\\nðŸ“§ Email: ${masjid.info.email}\\nðŸŒ Website: ${masjid.info.website}\\n\\nðŸ¢ **FASILITAS**\\nðŸ•Œ Masjid ber-AC 2000 jamaah\\nðŸš¿ Tempat wudhu pria/wanita\\nðŸš» Toilet modern + difabel\\nðŸ…¿ï¸ Parkir 500 motor, 200 mobil\\nðŸ“š Perpustakaan 5000+ buku\\nðŸ« 8 ruang kelas ber-AC\\nðŸ½ï¸ Dapur & aula 500 orang\\n\\nðŸ• **JAM OPERASIONAL**\\nIbadah: 24 jam\\nAdmin: 08:00-16:00 WIB\\n\\nðŸŽ¯ **VISI**\\nPusat ibadah & dakwah terdepan\\n\\nðŸ“‹ **MISI**\\nâ€¢ Melayani umat\\nâ€¢ Pendidikan Islam\\nâ€¢ Ekonomi syariah\\nâ€¢ Kepedulian sosial`;\n  },\n  \n  live_streaming: () => `ðŸ“º *LIVE STREAMING*\\nðŸ“ ${data.masjid.info.nama}\\n\\nðŸ“± **PLATFORM:**\\nâ€¢ YouTube: Masjid Al-Ikhlas TV\\nâ€¢ Facebook: @MasjidAlIkhlas\\nâ€¢ Instagram: @masjidalukhlas\\nâ€¢ Website: ${data.masjid.info.website}/live\\n\\nðŸ•Œ **JADWAL STREAMING:**\\nðŸŒ… Subuh: 04:30-05:30\\nâ˜€ï¸ Dzuhur: 12:15-12:45\\nðŸŒ™ Magrib: 18:45-19:15\\nðŸ•Œ Jumat: 11:30-13:00 (Full)\\n\\nðŸ“š **KAJIAN LIVE:**\\nðŸ•— Senin: Tafsir Al-Quran\\nðŸ•— Rabu: Fiqh Muamalah\\nðŸ•— Sabtu: Kajian Wanita\\n\\nðŸŽ¥ **FITUR:**\\nâœ… HD Quality (1080p)\\nâœ… Audio jernih\\nâœ… Interactive chat\\nâœ… Recording tersedia\\n\\nðŸ“Š **STATS:**\\nðŸ‘¥ 1000+ viewers rata-rata\\nðŸ’¬ Active community\\n\\nðŸ”” Subscribe & bell notification\\nðŸ“± Info: ${data.masjid.info.whatsapp}`,\n  \n  salam_greeting: () => {\n    const timeGreeting = () => {\n      const hour = moment().hour();\n      if (hour < 6) return 'dini hari';\n      if (hour < 11) return 'pagi';\n      if (hour < 15) return 'siang';\n      if (hour < 18) return 'sore';\n      return 'malam';\n    };\n    \n    return `ÙˆÙŽØ¹ÙŽÙ„ÙŽÙŠÙ’ÙƒÙÙ…Ù Ø§Ù„Ø³ÙŽÙ‘Ù„ÙŽØ§Ù…Ù ÙˆÙŽØ±ÙŽØ­Ù’Ù…ÙŽØ©Ù Ø§Ù„Ù„ÙŽÙ‘Ù‡Ù ÙˆÙŽØ¨ÙŽØ±ÙŽÙƒÙŽØ§ØªÙÙ‡Ù\\n\\n*Wa'alaikumussalam warahmatullahi wabarakatuh*\\n\\nSelamat ${timeGreeting()} dan selamat datang di\\nðŸ•Œ **${data.masjid.info.nama}**\\n\\nðŸ“± **MENU LAYANAN:**\\n\\nðŸ•Œ **IBADAH & SPIRITUAL**\\n1ï¸âƒ£ Jadwal Shalat\\n2ï¸âƒ£ Arah Kiblat\\n3ï¸âƒ£ Doa & Dzikir\\n4ï¸âƒ£ Ayat Al-Quran\\n5ï¸âƒ£ Hadits Nabi\\n\\nðŸ“š **PENDIDIKAN**\\n6ï¸âƒ£ Kajian & Pengajian\\n7ï¸âƒ£ TPQ & Tahfidz\\n8ï¸âƒ£ Konsultasi Syariah\\n\\nðŸ¤ **LAYANAN SOSIAL**\\n9ï¸âƒ£ Donasi & Zakat\\nðŸ”Ÿ Program Sosial\\n1ï¸âƒ£1ï¸âƒ£ Layanan Jenazah\\n\\n â„¹ï¸ **INFORMASI**\\n1ï¸âƒ£2ï¸âƒ£ Info Masjid\\n1ï¸âƒ£3ï¸âƒ£ Live Streaming\\n1ï¸âƒ£4ï¸âƒ£ Chat AI\\n\\nðŸ’¬ Ketik nama layanan atau chat langsung\\nðŸ¤– AI Assistant siap 24/7!\\n\\nðŸ• ${moment().format('HH:mm')} WIB - ${moment().format('dddd, DD/MM/YYYY')}`;\n  }\n};\n\nconst template = serviceTemplates[data.intent];\nif (!template) {\n  return [{\n    json: {\n      ...data,\n      response: `âŒ Service \"${data.intent}\" belum tersedia.\\n\\nKetik \"menu\" untuk melihat layanan atau chat langsung dengan AI.`,\n      response_type: 'TEMPLATE_NOT_FOUND'\n    }\n  }];\n}\n\nconst response = template();\n\nreturn [{\n  json: {\n    ...data,\n    response: response,\n    response_type: 'SERVICE_TEMPLATE'\n  }\n}];"
      },
      "id": "5",
      "name": "ðŸ“‹ Service Templates",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [950, 500]
    },
    {
      "parameters": {
        "url": "https://api.fonnte.com/send",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "YOUR_WHATSAPP_API_KEY"
            }
          ]
        },
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "target",
              "value": "={{ $json.phone }}"
            },
            {
              "name": "message",
              "value": "={{ $json.response }}"
            },
            {
              "name": "countryCode",
              "value": "62"
            }
          ]
        }
      },
      "id": "6",
      "name": "ðŸ“¤ WhatsApp Sender",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1200, 400]
    },
    {
      "parameters": {
        "url": "={{ $json.config.apis.supabase_url }}/rest/v1/chat_logs",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $json.config.apis.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "Bearer {{ $json.config.apis.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=minimal"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "user_phone",
              "value": "={{ $json.phone }}"
            },
            {
              "name": "intent",
              "value": "={{ $json.intent }}"
            },
            {
              "name": "confidence",
              "value": "={{ $json.confidence || 0 }}"
            },
            {
              "name": "response_type",
              "value": "={{ $json.response_type }}"
            },
            {
              "name": "processing_time",
              "value": "={{ $json.processing_time }}"
            },
            {
              "name": "timestamp",
              "value": "={{ $json.timestamp }}"
            },
            {
              "name": "day_name",
              "value": "={{ $json.day_name }}"
            },
            {
              "name": "ai_model",
              "value": "={{ $json.ai_model || 'none' }}"
            },
            {
              "name": "ai_tokens",
              "value": "={{ $json.ai_tokens || 0 }}"
            }
          ]
        }
      },
      "id": "7",
      "name": "ðŸ“Š Supabase Logger",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1200, 500]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ {\n  \"success\": true,\n  \"message\": \"Replit workflow completed\",\n  \"data\": {\n    \"phone\": $json.phone,\n    \"intent\": $json.intent,\n    \"confidence\": $json.confidence || 0,\n    \"response_type\": $json.response_type,\n    \"processing_time\": $json.processing_time + \"ms\",\n    \"timestamp\": $json.timestamp,\n    \"hosted_on\": \"replit\"\n  }\n} }}"
      },
      "id": "8",
      "name": "âœ… Success Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1450, 450]
    }
  ],
  "connections": {
    "ðŸ“± WhatsApp Gateway": {
      "main": [
        [
          {
            "node": "ðŸ§  Smart Processor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ§  Smart Processor": {
      "main": [
        [
          {
            "node": "ðŸ¤– Need AI?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ¤– Need AI?": {
      "main": [
        [
          {
            "node": "ðŸ¤– AI Engine",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ðŸ“‹ Service Templates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ¤– AI Engine": {
      "main": [
        [
          {
            "node": "ðŸ“¤ WhatsApp Sender",
            "type": "main",
            "index": 0
          },
          {
            "node": "ðŸ“Š Supabase Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“‹ Service Templates": {
      "main": [
        [
          {
            "node": "ðŸ“¤ WhatsApp Sender",
            "type": "main",
            "index": 0
          },
          {
            "node": "ðŸ“Š Supabase Logger",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“¤ WhatsApp Sender": {
      "main": [
        [
          {
            "node": "âœ… Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“Š Supabase Logger": {
      "main": [
        [
          {
            "node": "âœ… Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2.0",
  "id": "masjid-ai-replit-workflow",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "tags": [
    {
      "id": "replit-ready",
      "name": "Replit Ready"
    },
    {
      "id": "masjid-ai",
      "name": "Masjid AI"
    },
    {
      "id": "optimized",
      "name": "Optimized"
    }
  ]
}